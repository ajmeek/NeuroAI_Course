
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Macrocircuits &#8212; Neuromatch Academy: NeuroAI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/vnd.jupyter.widget-state+json">{"state": {"e632de3aa5254b379933ca6532d0b733": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d5332e467da448bbacade2bef430db2b": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_e632de3aa5254b379933ca6532d0b733", "msg_id": "", "outputs": [{"output_type": "stream", "name": "stdout", "text": "Video available at https://youtube.com/watch?v=CwOUn0Bt4JU\n"}, {"output_type": "display_data", "metadata": {}, "data": {"text/plain": "<IPython.lib.display.YouTubeVideo at 0x7f48744139d0>", "text/html": "\n        <iframe\n            width=\"730\"\n            height=\"410\"\n            src=\"https://www.youtube.com/embed/CwOUn0Bt4JU?fs=1&rel=0\"\n            frameborder=\"0\"\n            allowfullscreen\n            \n        ></iframe>\n        ", "image/jpeg": "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dHctpLCxx61Tsw6t3DYFT+mdp1Id1/qTpnadSHdf6kKlbRk1uFXEnEk0aKkihOb/AN9tVuyxNa4OBIINczR/aG9g0BU/pnadSHdf6k6Z2nUh3X+pCpXSKzhrnOqTeNXA0x/zN4U0Lk3J7QAA51AKdmbGozdtSqh0ztOpDuv9SdM7TqQ7r/UhUreLCBme8UGHs4dUNBzZwBh713ZEAAOwCgzf52Kk9M7TqQ7r/UnTO06kO6/1J4lald+LCXFSOmdp1Id1/qTpnadSHdf6lNuJ8l3DE4tUjpnadSHdf6k6Z2nUh3X+pTbifJeLiXFR+mdp1Id1/qTpnadSHdf6laxPku9xCwKkdM7TqQ7r/UnTO06kO6/1JtxPku/FhZLFR+mdp1Id1/qTpnadSHdf6lNuJ8l3DEuKkdM7TqQ7r/UnTO06kO6/1K7cT5LvcWwFFRumdp1Id1/qTpnadSHdf6kiIjom5XpFRemdp1Id1/qTpnadSHdf6lq02yvSKi9M7TqQ7r/UnTO06kO6/wBSWbZV1ERZbEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERB//2Q==\n"}}], "tabbable": null, "tooltip": null}}, "762ec9dbf75246b3965d2bf96ebf2f65": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7d8fb603ce4f40b4b0c3539d93d5dbcc": {"model_name": "TabModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "TabModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "TabView", "box_style": "", "children": ["IPY_MODEL_d5332e467da448bbacade2bef430db2b"], "layout": "IPY_MODEL_762ec9dbf75246b3965d2bf96ebf2f65", "selected_index": 0, "tabbable": null, "titles": ["Youtube"], "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'projects/project-notebooks/Macrocircuits';</script>
    <link rel="shortcut icon" href="../../_static/ai-logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Microlearning" href="Microlearning.html" />
    <link rel="prev" title="Datasets" href="../docs/datasets_overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../tutorials/intro.html">

  
  
  
  
  
  
  

  
    <img src="../../_static/ai-logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/ai-logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/Schedule/schedule_intro.html">
                        Schedule
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/TechnicalHelp/tech_intro.html">
                        Technical Help
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/TechnicalHelp/Links_Policy.html">
                        Quick links and policies
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../prereqs/NeuroAI.html">
                        Prerequisites and preparatory materials for NeuroAI course
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D1_Generalization/chapter_title.html">
                        Generalization (W1D1)
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D2_ComparingTasks/chapter_title.html">
                        Comparing Tasks (W1D2)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">
                        Comparing Artificial And Biological Networks (W1D3)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D5_Microcircuits/chapter_title.html">
                        Microcircuits (W1D5)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D1_Macrocircuits/chapter_title.html">
                        Macrocircuits (W2D1)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/chapter_title.html">
                        Neuro Symbolic Methods (W2D2)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D3_Microlearning/chapter_title.html">
                        Microlearning (W2D3)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D4_Macrolearning/chapter_title.html">
                        Macrolearning (W2D4)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D5_Mysteries/chapter_title.html">
                        Mysteries (W2D5)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../README.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../docs/project_guidance.html">
                        Daily guide for projects
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../docs/datasets_overview.html">
                        Project materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/README.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/impact_talks.html">
                        Impact Talks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/mentorship_program.html">
                        Mentorship Program
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/career_features.html">
                        Career Features
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/career_panels.html">
                        Career Panels
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/Schedule/schedule_intro.html">
                        Schedule
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/TechnicalHelp/tech_intro.html">
                        Technical Help
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/TechnicalHelp/Links_Policy.html">
                        Quick links and policies
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../prereqs/NeuroAI.html">
                        Prerequisites and preparatory materials for NeuroAI course
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D1_Generalization/chapter_title.html">
                        Generalization (W1D1)
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D2_ComparingTasks/chapter_title.html">
                        Comparing Tasks (W1D2)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">
                        Comparing Artificial And Biological Networks (W1D3)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W1D5_Microcircuits/chapter_title.html">
                        Microcircuits (W1D5)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D1_Macrocircuits/chapter_title.html">
                        Macrocircuits (W2D1)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/chapter_title.html">
                        Neuro Symbolic Methods (W2D2)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D3_Microlearning/chapter_title.html">
                        Microlearning (W2D3)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D4_Macrolearning/chapter_title.html">
                        Macrolearning (W2D4)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/W2D5_Mysteries/chapter_title.html">
                        Mysteries (W2D5)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../README.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../docs/project_guidance.html">
                        Daily guide for projects
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../docs/datasets_overview.html">
                        Project materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/README.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/impact_talks.html">
                        Impact Talks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/mentorship_program.html">
                        Mentorship Program
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/career_features.html">
                        Career Features
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../professional_development/career_panels.html">
                        Career Panels
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../../tutorials/intro.html">

  
  
  
  
  
  
  

  
    <img src="../../_static/ai-logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/ai-logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../tutorials/intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/Schedule/schedule_intro.html">Schedule</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/Schedule/daily_schedules.html">General schedule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/Schedule/shared_calendars.html">Shared calendars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/Schedule/timezone_widget.html">Timezone widget</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/TechnicalHelp/tech_intro.html">Technical Help</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/TechnicalHelp/Jupyterbook.html">Using jupyterbook</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/TechnicalHelp/Tutorial_colab.html">Using Google Colab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/TechnicalHelp/Tutorial_kaggle.html">Using Kaggle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/TechnicalHelp/Discord.html">Using discord</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/TechnicalHelp/Links_Policy.html">Quick links and policies</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../prereqs/NeuroAI.html">Prerequisites and preparatory materials for NeuroAI course</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Foundations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W1D1_Generalization/chapter_title.html">Generalization (W1D1)</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D1_Generalization/student/W1D1_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D1_Generalization/student/W1D1_Tutorial1.html">Tutorial 1: Generalization in AI</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D1_Generalization/student/W1D1_Tutorial2.html">Tutorial 2: Generalization in Neuroscience</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D1_Generalization/student/W1D1_Tutorial3.html">Tutorial 3: Generalization in Cognitive Science</a></li>





</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W1D2_ComparingTasks/chapter_title.html">Comparing Tasks (W1D2)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D2_ComparingTasks/student/W1D2_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D2_ComparingTasks/student/W1D2_Tutorial1.html">Tutorial 1: Task definition, application, relations and impacts on generalization</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D2_ComparingTasks/student/W1D2_Tutorial2.html">Tutorial 2: Contrastive learning for object recognition</a></li>


<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D2_ComparingTasks/student/W1D2_Tutorial3.html">Tutorial 3: Reinforcement learning across temporal scales</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">Comparing Artificial And Biological Networks (W1D3)</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial1.html">Tutorial 1: Generalization and representational geometry</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial2.html">Tutorial 2: Computation as transformation of representational geometries</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial3.html">Tutorial 3: Statistical inference on representational geometries</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial4.html">Tutorial 4: Representational geometry &amp; noise</a></li>






</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Architectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W1D5_Microcircuits/chapter_title.html">Microcircuits (W1D5)</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D5_Microcircuits/student/W1D5_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D5_Microcircuits/student/W1D5_Tutorial1.html">Tutorial 1: Sparsity and Sparse Coding</a></li>









<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D5_Microcircuits/student/W1D5_Tutorial2.html">Tutorial 2: Normalization</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W1D5_Microcircuits/student/W1D5_Tutorial3.html">Tutorial 3: Attention</a></li>





</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W2D1_Macrocircuits/chapter_title.html">Macrocircuits (W2D1)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D1_Macrocircuits/student/W2D1_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D1_Macrocircuits/student/W2D1_Tutorial1.html">Tutorial 1: Depth vs width</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D1_Macrocircuits/student/W2D1_Tutorial2.html">Tutorial 2: Double descent</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D1_Macrocircuits/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/chapter_title.html">Neuro Symbolic Methods (W2D2)</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/student/W2D2_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial1.html">Tutorial 1: Basic operations of vector symbolic algebra</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial2.html">Tutorial 2: Learning with structures</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial3.html">Tutorial 3: Representations in continuous space</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D2_NeuroSymbolicMethods/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W2D3_Microlearning/chapter_title.html">Microlearning (W2D3)</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D3_Microlearning/student/W2D3_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D3_Microlearning/student/W2D3_Tutorial1.html">Tutorial 1: Microlearning</a></li>










</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/chapter_title.html">Macrolearning (W2D4)</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Tutorial1.html">Tutorial 1: The problem of changing data distributions</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Tutorial2.html">Tutorial 2: Continual learning</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Tutorial3.html">Tutorial 3: Meta-learning</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Tutorial4.html">Tutorial 4: Biological meta reinforcement learning</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/student/W2D4_Tutorial5.html">Tutorial 5: Replay</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D4_Macrolearning/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mysteries</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/W2D5_Mysteries/chapter_title.html">Mysteries (W2D5)</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D5_Mysteries/student/W2D5_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D5_Mysteries/student/W2D5_Tutorial1.html">Tutorial 1: Consciousness</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D5_Mysteries/student/W2D5_Tutorial2.html">Tutorial 2: Ethics</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../tutorials/W2D5_Mysteries/student/W2D5_Outro.html">Outro</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Booklet</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/project_guidance.html">Daily guide for projects</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../docs/datasets_overview.html">Project materials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Macrocircuits</a></li>






<li class="toctree-l2"><a class="reference internal" href="Microlearning.html">Microlearning</a></li>
<li class="toctree-l2"><a class="reference internal" href="ComparingNetworks.html">Comparing Networks</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Professional Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../professional_development/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../professional_development/impact_talks.html">Impact Talks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../professional_development/mentorship_program.html">Professional developemnt</a></li>



<li class="toctree-l1"><a class="reference internal" href="../professional_development/career_features.html">Career Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../professional_development/career_panels.html">Career Panels</a></li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">


<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
  </ul>
</div>

<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/neuromatch/NeuroAI_Course" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/neuromatch/NeuroAI_Course/issues/new?title=Issue%20on%20page%20%2Fprojects/project-notebooks/Macrocircuits.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="../../_sources/projects/project-notebooks/Macrocircuits.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Macrocircuits</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Macrocircuits
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-background">
       Project Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-slides">
       Project slides
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-template">
       Project Template
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-setup">
   Initial Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-colab-gpu-case-uncomment-if-you-want-to-use-this-one">
     Installing Dependencies (Colab GPU case, uncomment if you want to use this one)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-kaggle-gpu-case-uncomment-if-you-want-to-use-this-one">
     Installing Dependencies (Kaggle GPU case, uncomment if you want to use this one)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-cpu-case-comment-if-you-want-to-use-gpu-one">
     Installing Dependencies (CPU case, comment if you want to use GPU one)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#imports-and-utility-functions">
       Imports and Utility Functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#importing-libraries">
         Importing Libraries
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#utility-code-for-displaying-videos">
         Utility code for displaying videos
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-1-exploring-the-deepmind-swimmer">
   Section 1: Exploring the DeepMind Swimmer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-basic-swim-task-for-the-swimmer-environment">
     1.1 Create a basic swim task for the swimmer environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vizualizing-an-agent-that-takes-random-actions-in-the-environment">
     1.2 Vizualizing an agent that takes random actions in the environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#swimmer-agent-api">
     1.3 Swimmer Agent API
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-simple-modification-to-the-agent">
     1.4 Example of simple modification to the agent
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-2-training-models-on-the-swim-task">
   Section 2: Training models on the swim task
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-install-tonic-library-for-training-agents">
     Download and install tonic library for training agents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-1-defining-the-train-function">
     Section 2.1 Defining the train function
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-2-training-mlp-model-on-swim-task">
     Section 2.2 Training MLP model on swim task
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-3-function-to-run-any-model-on-the-environment-and-generate-video">
     Section 2.3 Function to run any model on the environment and generate video
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#uncomment-and-use-gpu-to-observe-video">
       Uncomment and use GPU to observe video
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-3-ncap">
   Section 3: NCAP
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paper-illustration">
     Paper Illustration
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ncap-classes">
     3.1 NCAP classes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-1-defining-the-constraints">
       Section 3.1.1 Defining the constraints
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-2-defining-the-swimmermodule">
       Section 3.1.2: Defining the
       <em>
        <strong>
         SwimmerModule
        </strong>
       </em>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-3-defining-the-swimmeractor-wrapper">
       Section 3.1.3: Defining the
       <em>
        <strong>
         SwimmerActor
        </strong>
       </em>
       wrapper
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-ncap">
     3.2: Train NCAP
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Uncomment and use GPU to observe video
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-perfomance">
     3.3 Plot perfomance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-4-visualizing-the-sparse-network">
   Section 4: Visualizing the sparse network
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <p><a href="https://colab.research.google.com/github/neuromatch/NeuroAI_Course/blob/main/projects/project-notebooks/Macrocircuits.ipynb" target="_blank"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a>   <a href="https://kaggle.com/kernels/welcome?src=https://raw.githubusercontent.com/neuromatch/NeuroAI_Course/main/projects/project-notebooks/Macrocircuits.ipynb" target="_blank"><img alt="Open in Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg" /></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="macrocircuits">
<h1>Macrocircuits<a class="headerlink" href="#macrocircuits" title="Permalink to this heading">#</a></h1>
<p><em><strong>Macrocircuits: Leveraging neural architectural priors and modularity in embodied agents</strong></em></p>
<p><strong>By Neuromatch Academy</strong></p>
<p><strong>Content creators:</strong> Divyansha Lachi, Kseniia Shilova</p>
<p><strong>Content reviewers:</strong> Eva Dyer, Hannah Choi</p>
<p><strong>Production editors:</strong> Konstantine Tsafatinos, Ella Batty, Spiros Chavlis, Samuele Bolotta, Hlib Solodzhuk</p>
<hr class="docutils" />
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>This project explores how we can build a biologically inspired artificial neural network (ANN) architecture, derived from the C. Elegans motor circuit, for the control of a simulated Swimmer agent. Traditional motor control ANNs often rely on generic, fully connected multilayer perceptrons (MLPs), which demand extensive training data, offer limited transferability, and possess complex internal dynamics that challenge interpretability. The project aims to understand how the biologically motivated ANN, which is shaped by evolution to be highly structured and sparse, could help to solve these problems and provide advantages in the domain of motor control. We will train MLPs using algorithms such as PPO, DDPG, and ES, and compare their performance in terms of rewards and sample efficiency with our bio-inspired ANN. The project also includes visualizing the C. Elegans connectome and building the network using this circuitry. We will conduct various ablation analyses by removing sign and weight-sharing constraints, and altering environmental parameters like the swimmer’s length or viscosity. These investigations aim to understand how architecture and modularity impact performance and learning across different environments. Finally, the project aims at building an agent that is robust to environmental variations, navigating towards specific targets, and enhancing our understanding of bio-inspired motor control.</p>
<p><strong>Relevant references:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/2201.05242">Neural circuit architectural priors for embodied control</a></p></li>
<li><p><a class="reference external" href="https://www.nature.com/articles/s41467-019-13239-6">Hierarchical motor control in mammals and machines</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/pdf/1509.02971.pdf">Continuous control with deep reinforcement learning</a></p></li>
</ul>
<p><em>This notebook uses code from the following GitHub repository:</em> <a class="reference external" href="https://github.com/nikhilxb/ncap">ncap</a> by Nikhil X. Bhattasali and Anthony M. Zador and Tatiana A. Engel.</p>
<p><strong>Infrastructure note:</strong> This notebook contains GPU install guide as well as CPU ones for different OS.</p>
<section id="project-background">
<h3>Project Background<a class="headerlink" href="#project-background" title="Permalink to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "7d8fb603ce4f40b4b0c3539d93d5dbcc"}</script></div>
</div>
</section>
<section id="project-slides">
<h3>Project slides<a class="headerlink" href="#project-slides" title="Permalink to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to download the slides: https://osf.io/download/cz93b/
</pre></div>
</div>
<div class="output text_html">
        <iframe
            width="854"
            height="480"
            src="https://mfr.ca-1.osf.io/render?url=https://osf.io/download/cz93b/?direct%26mode=render"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="project-template">
<h3>Project Template<a class="headerlink" href="#project-template" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Project Template</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/neuromatch/NeuroAI_Course/blob/main/projects/project-notebooks/static/NCAPProjectTemplate.png?raw=true&quot;</span>

<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://github.com/neuromatch/NeuroAI_Course/blob/main/projects/project-notebooks/static/NCAPProjectTemplate.png?raw=true"/></div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="initial-setup">
<h1>Initial Setup<a class="headerlink" href="#initial-setup" title="Permalink to this heading">#</a></h1>
<p><strong>IF USING COLAB (recommended):</strong></p>
<p>Uncomment the cell below and run it.</p>
<section id="installing-dependencies-colab-gpu-case-uncomment-if-you-want-to-use-this-one">
<h2>Installing Dependencies (Colab GPU case, uncomment if you want to use this one)<a class="headerlink" href="#installing-dependencies-colab-gpu-case-uncomment-if-you-want-to-use-this-one" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Installing Dependencies (Colab GPU case, uncomment if you want to use this one)</span>

<span class="c1"># import distutils.util</span>
<span class="c1"># import os</span>
<span class="c1"># import subprocess</span>
<span class="c1"># if subprocess.run(&#39;nvidia-smi&#39;).returncode:</span>
<span class="c1">#   raise RuntimeError(</span>
<span class="c1">#       &#39;Cannot communicate with GPU. &#39;</span>
<span class="c1">#       &#39;Make sure you are using a GPU Colab runtime. &#39;</span>
<span class="c1">#       &#39;Go to the Runtime menu and select Choose runtime type.&#39;)</span>

<span class="c1"># # Add an ICD config so that glvnd can pick up the Nvidia EGL driver.</span>
<span class="c1"># # This is usually installed as part of an Nvidia driver package, but the Colab</span>
<span class="c1"># # kernel doesn&#39;t install its driver via APT, and as a result the ICD is missing.</span>
<span class="c1"># # (https://github.com/NVIDIA/libglvnd/blob/master/src/EGL/icd_enumeration.md)</span>
<span class="c1"># NVIDIA_ICD_CONFIG_PATH = &#39;/usr/share/glvnd/egl_vendor.d/10_nvidia.json&#39;</span>
<span class="c1"># if not os.path.exists(NVIDIA_ICD_CONFIG_PATH):</span>
<span class="c1">#   with open(NVIDIA_ICD_CONFIG_PATH, &#39;w&#39;) as f:</span>
<span class="c1">#     f.write(&quot;&quot;&quot;{</span>
<span class="c1">#     &quot;file_format_version&quot; : &quot;1.0.0&quot;,</span>
<span class="c1">#     &quot;ICD&quot; : {</span>
<span class="c1">#         &quot;library_path&quot; : &quot;libEGL_nvidia.so.0&quot;</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>
<span class="c1"># &quot;&quot;&quot;)</span>

<span class="c1"># print(&#39;Installing dm_control...&#39;)</span>
<span class="c1"># !pip install -q dm_control&gt;=1.0.16</span>

<span class="c1"># # Configure dm_control to use the EGL rendering backend (requires GPU)</span>
<span class="c1"># %env MUJOCO_GL=egl</span>

<span class="c1"># print(&#39;Checking that the dm_control installation succeeded...&#39;)</span>
<span class="c1"># try:</span>
<span class="c1">#   from dm_control import suite</span>
<span class="c1">#   env = suite.load(&#39;cartpole&#39;, &#39;swingup&#39;)</span>
<span class="c1">#   pixels = env.physics.render()</span>
<span class="c1"># except Exception as e:</span>
<span class="c1">#   raise e from RuntimeError(</span>
<span class="c1">#       &#39;Something went wrong during installation. Check the shell output above &#39;</span>
<span class="c1">#       &#39;for more information.\n&#39;</span>
<span class="c1">#       &#39;If using a hosted Colab runtime, make sure you enable GPU acceleration &#39;</span>
<span class="c1">#       &#39;by going to the Runtime menu and selecting &quot;Choose runtime type&quot;.&#39;)</span>
<span class="c1"># else:</span>
<span class="c1">#   del pixels, suite</span>

<span class="c1"># !echo Installed dm_control $(pip show dm_control | grep -Po &quot;(?&lt;=Version: ).+&quot;)</span>
<span class="c1"># !pip install -q dm-acme[envs]</span>
<span class="c1"># !mkdir output_videos</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>IF USING KAGGLE (recommended):</strong></p>
<p>Uncomment the cell below and run it.</p>
</section>
<section id="installing-dependencies-kaggle-gpu-case-uncomment-if-you-want-to-use-this-one">
<h2>Installing Dependencies (Kaggle GPU case, uncomment if you want to use this one)<a class="headerlink" href="#installing-dependencies-kaggle-gpu-case-uncomment-if-you-want-to-use-this-one" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Installing Dependencies (Kaggle GPU case, uncomment if you want to use this one)</span>

<span class="c1"># import subprocess</span>

<span class="c1"># subprocess.run([&quot;sudo&quot;, &quot;apt-get&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;libgl1-mesa-glx&quot;, &quot;libosmesa6&quot;])</span>
<span class="c1"># subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-q&quot;, &quot;imageio[ffmpeg]&quot;])</span>

<span class="c1"># print(&#39;Installing dm_control...&#39;)</span>
<span class="c1"># !pip install -q dm_control&gt;=1.0.16</span>

<span class="c1"># %env MUJOCO_GL=osmesa</span>

<span class="c1"># print(&#39;Checking that the dm_control installation succeeded...&#39;)</span>
<span class="c1"># try:</span>
<span class="c1">#   from dm_control import suite</span>
<span class="c1">#   env = suite.load(&#39;cartpole&#39;, &#39;swingup&#39;)</span>
<span class="c1">#   pixels = env.physics.render()</span>
<span class="c1"># except Exception as e:</span>
<span class="c1">#   raise e from RuntimeError(</span>
<span class="c1">#       &#39;Something went wrong during installation.&#39;)</span>
<span class="c1"># else:</span>
<span class="c1">#   del pixels, suite</span>

<span class="c1"># !echo Installed dm_control $(pip show dm_control | grep -Po &quot;(?&lt;=Version: ).+&quot;)</span>
<span class="c1"># !pip install -q dm-acme[envs]</span>
<span class="c1"># !mkdir output_videos</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>IF RUNNING LOCALLY</strong></p>
<p>Uncomment the relevant lines of code depending on your OS.</p>
</section>
<section id="installing-dependencies-cpu-case-comment-if-you-want-to-use-gpu-one">
<h2>Installing Dependencies (CPU case, comment if you want to use GPU one)<a class="headerlink" href="#installing-dependencies-cpu-case-comment-if-you-want-to-use-gpu-one" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Installing Dependencies (CPU case, comment if you want to use GPU one)</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1">############### For Linux #####################</span>
<span class="c1"># subprocess.run([&quot;sudo&quot;, &quot;apt-get&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;libglew-dev&quot;])</span>
<span class="c1"># subprocess.run([&quot;sudo&quot;, &quot;apt-get&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;libglfw3&quot;])</span>
<span class="c1"># subprocess.run([&quot;sudo&quot;, &quot;apt&quot;, &quot;install&quot;, &quot;ffmpeg&quot;])</span>
<span class="c1">###############################################</span>

<span class="c1">############### For MacOS #####################</span>
<span class="c1"># subprocess.run([&quot;brew&quot;, &quot;install&quot;, &quot;glew&quot;])</span>
<span class="c1"># subprocess.run([&quot;brew&quot;, &quot;install&quot;, &quot;glfw&quot;])</span>
<span class="c1">###############################################</span>

<span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;ffmpeg&quot;</span><span class="p">])</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;dm-acme[envs]&quot;</span><span class="p">])</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;dm_control&gt;=1.0.16&quot;</span><span class="p">])</span>

<span class="o">!</span>mkdir<span class="w"> </span>output_videos
</pre></div>
</div>
</div>
</details>
</div>
<section id="imports-and-utility-functions">
<h3>Imports and Utility Functions<a class="headerlink" href="#imports-and-utility-functions" title="Permalink to this heading">#</a></h3>
<section id="importing-libraries">
<h4>Importing Libraries<a class="headerlink" href="#importing-libraries" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Importing Libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">T</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="kn">import</span> <span class="nn">dm_control</span> <span class="k">as</span> <span class="nn">dm</span>
<span class="kn">import</span> <span class="nn">dm_control.suite.swimmer</span> <span class="k">as</span> <span class="nn">swimmer</span>
<span class="kn">from</span> <span class="nn">dm_control.rl</span> <span class="kn">import</span> <span class="n">control</span>
<span class="kn">from</span> <span class="nn">dm_control.utils</span> <span class="kn">import</span> <span class="n">rewards</span>
<span class="kn">from</span> <span class="nn">dm_control</span> <span class="kn">import</span> <span class="n">suite</span>
<span class="kn">from</span> <span class="nn">dm_control.suite.wrappers</span> <span class="kn">import</span> <span class="n">pixels</span>

<span class="kn">from</span> <span class="nn">acme</span> <span class="kn">import</span> <span class="n">wrappers</span>

<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="utility-code-for-displaying-videos">
<h4>Utility code for displaying videos<a class="headerlink" href="#utility-code-for-displaying-videos" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Utility code for displaying videos</span>
<span class="k">def</span> <span class="nf">write_video</span><span class="p">(</span>
  <span class="n">filepath</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span>
  <span class="n">frames</span><span class="p">:</span> <span class="n">T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
  <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
  <span class="n">macro_block_size</span><span class="p">:</span> <span class="n">T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
  <span class="n">quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
  <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
  <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Saves a sequence of frames as a video file.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  - filepath (os.PathLike): Path to save the video file.</span>
<span class="sd">  - frames (Iterable[np.ndarray]): An iterable of frames, where each frame is a numpy array.</span>
<span class="sd">  - fps (int, optional): Frames per second, defaults to 60.</span>
<span class="sd">  - macro_block_size (Optional[int], optional): Macro block size for video encoding, can affect compression efficiency.</span>
<span class="sd">  - quality (int, optional): Quality of the output video, higher values indicate better quality.</span>
<span class="sd">  - verbose (bool, optional): If True, prints the file path where the video is saved.</span>
<span class="sd">  - **kwargs: Additional keyword arguments passed to the imageio.get_writer function.</span>

<span class="sd">  Returns:</span>
<span class="sd">  None. The video is written to the specified filepath.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">with</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                        <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span>
                        <span class="n">macro_block_size</span><span class="o">=</span><span class="n">macro_block_size</span><span class="p">,</span>
                        <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">video</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving video to:&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
      <span class="n">video</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_video</span><span class="p">(</span>
  <span class="n">frames</span><span class="p">:</span> <span class="n">T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
  <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;output_videos/temp.mp4&#39;</span><span class="p">,</span>
  <span class="n">fps</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
  <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Displays a video within a Jupyter Notebook from an iterable of frames.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  - frames (Iterable[np.ndarray]): An iterable of frames, where each frame is a numpy array.</span>
<span class="sd">  - filename (str, optional): Temporary filename to save the video before display, defaults to &#39;output_videos/temp.mp4&#39;.</span>
<span class="sd">  - fps (int, optional): Frames per second for the video display, defaults to 60.</span>
<span class="sd">  - **kwargs: Additional keyword arguments passed to the write_video function.</span>

<span class="sd">  Returns:</span>
<span class="sd">  HTML object: An HTML video element that can be displayed in a Jupyter Notebook.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># Write video to a temporary file.</span>
  <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="n">write_video</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
  <span class="n">dpi</span> <span class="o">=</span> <span class="mi">70</span>
  <span class="n">orig_backend</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
  <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>  <span class="c1"># Switch to headless &#39;Agg&#39; to inhibit figure rendering.</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">dpi</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
  <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">orig_backend</span><span class="p">)</span>  <span class="c1"># Switch back to the original backend.</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">im</span><span class="p">]</span>
  <span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="n">fps</span>
  <span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
                                  <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In this notebook we will explore the major components essential for this project.</p>
<ul class="simple">
<li><p><strong>Understanding the DeepMind Control Suite Swimmer Agent:</strong> We will begin by exploring the swimmer agent provided by the DeepMind Control Suite. This section includes a detailed exploration of the agent’s API, task customization capabilities, and how to adapt the environment to fit our experimental needs.</p></li>
<li><p><strong>Training Models Using Various Reinforcement Learning Algorithms:</strong> Next, we move on to learn how can we train models for the agents we created. We will be using Tonic_RL library to train our model. We will first train a standard MLP model using the Proximal Policy Optimization (PPO) algorithm.</p></li>
<li><p><strong>Training the NCAP model:</strong> Finally we will define the NCAP model from <a class="reference external" href="https://arxiv.org/abs/2201.05242">Neural Circuit Architectural Priors for Embodied Control</a> paper. We will train it using PPO and compare it against the MLP model we trained before.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="section-1-exploring-the-deepmind-swimmer">
<h1>Section 1: Exploring the DeepMind Swimmer<a class="headerlink" href="#section-1-exploring-the-deepmind-swimmer" title="Permalink to this heading">#</a></h1>
<section id="create-a-basic-swim-task-for-the-swimmer-environment">
<h2>1.1 Create a basic swim task for the swimmer environment<a class="headerlink" href="#create-a-basic-swim-task-for-the-swimmer-environment" title="Permalink to this heading">#</a></h2>
<p>First, we’ll initialize a basic swimmer agent consisting of 6 links. Each agent requires a defined task and its corresponding reward function. In this instance, we’ve designed a swim forward task that involves the agent swimming forward in any direction.</p>
<p>The environment is flexible, allowing for modifications to introduce additional tasks such as “swim only in the x-direction” or “move towards a ball.”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_SWIM_SPEED</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="nd">@swimmer</span><span class="o">.</span><span class="n">SUITE</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">swim</span><span class="p">(</span>
  <span class="n">n_links</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
  <span class="n">desired_speed</span><span class="o">=</span><span class="n">_SWIM_SPEED</span><span class="p">,</span>
  <span class="n">time_limit</span><span class="o">=</span><span class="n">swimmer</span><span class="o">.</span><span class="n">_DEFAULT_TIME_LIMIT</span><span class="p">,</span>
  <span class="n">random</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">environment_kwargs</span><span class="o">=</span><span class="p">{},</span>
<span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Returns the Swim task for a n-link swimmer.&quot;&quot;&quot;</span>
  <span class="n">model_string</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="n">swimmer</span><span class="o">.</span><span class="n">get_model_and_assets</span><span class="p">(</span><span class="n">n_links</span><span class="p">)</span>
  <span class="n">physics</span> <span class="o">=</span> <span class="n">swimmer</span><span class="o">.</span><span class="n">Physics</span><span class="o">.</span><span class="n">from_xml_string</span><span class="p">(</span><span class="n">model_string</span><span class="p">,</span> <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">)</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">Swim</span><span class="p">(</span><span class="n">desired_speed</span><span class="o">=</span><span class="n">desired_speed</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="n">random</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">control</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">physics</span><span class="p">,</span>
    <span class="n">task</span><span class="p">,</span>
    <span class="n">time_limit</span><span class="o">=</span><span class="n">time_limit</span><span class="p">,</span>
    <span class="n">control_timestep</span><span class="o">=</span><span class="n">swimmer</span><span class="o">.</span><span class="n">_CONTROL_TIMESTEP</span><span class="p">,</span>
    <span class="o">**</span><span class="n">environment_kwargs</span><span class="p">,</span>
  <span class="p">)</span>


<span class="k">class</span> <span class="nc">Swim</span><span class="p">(</span><span class="n">swimmer</span><span class="o">.</span><span class="n">Swimmer</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Task to swim forwards at the desired speed.&quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_speed</span><span class="o">=</span><span class="n">_SWIM_SPEED</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_desired_speed</span> <span class="o">=</span> <span class="n">desired_speed</span>

  <span class="k">def</span> <span class="nf">initialize_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">physics</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize_episode</span><span class="p">(</span><span class="n">physics</span><span class="p">)</span>
    <span class="c1"># Hide target by setting alpha to 0.</span>
    <span class="n">physics</span><span class="o">.</span><span class="n">named</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mat_rgba</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">physics</span><span class="o">.</span><span class="n">named</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mat_rgba</span><span class="p">[</span><span class="s1">&#39;target_default&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">physics</span><span class="o">.</span><span class="n">named</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mat_rgba</span><span class="p">[</span><span class="s1">&#39;target_highlight&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">get_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">physics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an observation of joint angles and body velocities.&quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;joints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">joints</span><span class="p">()</span>
    <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;body_velocities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">body_velocities</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">obs</span>

  <span class="k">def</span> <span class="nf">get_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">physics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a smooth reward that is 0 when stopped or moving backwards, and rises linearly to 1</span>
<span class="sd">    when moving forwards at the desired speed.&quot;&quot;&quot;</span>
    <span class="n">forward_velocity</span> <span class="o">=</span> <span class="o">-</span><span class="n">physics</span><span class="o">.</span><span class="n">named</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensordata</span><span class="p">[</span><span class="s1">&#39;head_vel&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rewards</span><span class="o">.</span><span class="n">tolerance</span><span class="p">(</span>
      <span class="n">forward_velocity</span><span class="p">,</span>
      <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_desired_speed</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)),</span>
      <span class="n">margin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_desired_speed</span><span class="p">,</span>
      <span class="n">value_at_margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
      <span class="n">sigmoid</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="vizualizing-an-agent-that-takes-random-actions-in-the-environment">
<h2>1.2 Vizualizing an agent that takes random actions in the environment<a class="headerlink" href="#vizualizing-an-agent-that-takes-random-actions-in-the-environment" title="Permalink to this heading">#</a></h2>
<p>Let’s visualize the environment by executing a sequence of random actions on a swimmer agent. This involves applying random actions over a series of steps and compiling the rendered frames into a video to visualize the agent’s behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; Renders the current environment state to an image &quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot; Tests a DeepMind control suite environment by executing a series of random actions &quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">test_dm_control</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="o">.</span><span class="n">CanonicalSpecWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="o">.</span><span class="n">SinglePrecisionWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_spec</span><span class="p">()</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">render</span><span class="p">(</span><span class="n">env</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">suite</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;swimmer&#39;</span><span class="p">,</span> <span class="s1">&#39;swim&#39;</span><span class="p">,</span> <span class="n">task_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_dm_control</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">test_dm_control</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="nn">Cell In[10], line 18,</span> in <span class="ni">test_dm_control</span><span class="nt">(env)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">timestep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

<span class="nn">Cell In[8], line 58,</span> in <span class="ni">display_video</span><span class="nt">(frames, filename, fps, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># Write video to a temporary file.</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span> <span class="n">write_video</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">70</span>

<span class="nn">Cell In[8], line 34,</span> in <span class="ni">write_video</span><span class="nt">(filepath, frames, fps, macro_block_size, quality, verbose, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving video to:&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">34</span>   <span class="n">video</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/core/format.py:590,</span> in <span class="ni">Format.Writer.append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">im</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Call</span>
<span class="ne">--&gt; </span><span class="mi">590</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_data</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">total_meta</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:587,</span> in <span class="ni">FfmpegFormat.Writer._append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
<span class="ne">--&gt; </span><span class="mi">587</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Check size of image</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:648,</span> in <span class="ni">FfmpegFormat.Writer._initialize</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ffmpeg_api</span><span class="o">.</span><span class="n">write_frames</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">631</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">632</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="n">audio_codec</span><span class="o">=</span><span class="n">audio_codec</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span> <span class="c1"># Seed the generator (this is where the ffmpeg subprocess starts)</span>
<span class="ne">--&gt; </span><span class="mi">648</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:508,</span> in <span class="ni">write_frames</span><span class="nt">(path, size, pix_fmt_in, pix_fmt_out, fps, quality, bitrate, codec, macro_block_size, ffmpeg_log_level, ffmpeg_timeout, input_params, output_params, audio_path, audio_codec)</span>
<span class="g g-Whitespace">    </span><span class="mi">506</span>         <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;msmpeg4&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">508</span>         <span class="n">codec</span> <span class="o">=</span> <span class="n">get_first_available_h264_encoder</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span> <span class="n">audio_params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-an&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span> <span class="k">if</span> <span class="n">audio_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gif&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:124,</span> in <span class="ni">get_first_available_h264_encoder</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="nd">@lru_cache</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">def</span> <span class="nf">get_first_available_h264_encoder</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">124</span>     <span class="n">compiled_encoders</span> <span class="o">=</span> <span class="n">get_compiled_h264_encoders</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">compiled_encoders</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>         <span class="k">if</span> <span class="n">ffmpeg_test_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:58,</span> in <span class="ni">get_compiled_h264_encoders</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">get_compiled_h264_encoders</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_ffmpeg_exe</span><span class="p">(),</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-encoders&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>         <span class="n">cmd</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>         <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:28,</span> in <span class="ni">get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="k">return</span> <span class="n">exe</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="c1"># Auto-detect</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">_get_ffmpeg_exe</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">if</span> <span class="n">exe</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:44,</span> in <span class="ni">_get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">plat</span> <span class="o">=</span> <span class="n">get_platform</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># 2. Try from here</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_bin_dir</span><span class="p">(),</span> <span class="n">FNAME_PER_PLATFORM</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plat</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="k">if</span> <span class="n">exe</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_valid_exe</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:69,</span> in <span class="ni">_get_bin_dir</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>     <span class="n">ref</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">as_file</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="k">with</span> <span class="n">context</span> <span class="k">as</span> <span class="n">path</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/resources.py:147,</span> in <span class="ni">files</span><span class="nt">(package)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="n">Package</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">resources_abc</span><span class="o">.</span><span class="n">Traversable</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Get a Traversable resource from a package</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">147</span>     <span class="k">return</span> <span class="n">_common</span><span class="o">.</span><span class="n">from_package</span><span class="p">(</span><span class="n">_get_package</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:14,</span> in <span class="ni">from_package</span><span class="nt">(package)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">def</span> <span class="nf">from_package</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span><span class="sd">     Return a Traversable object for the given package.</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">14</span>     <span class="k">return</span> <span class="n">fallback_resources</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">__spec__</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:18,</span> in <span class="ni">fallback_resources</span><span class="nt">(spec)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="k">def</span> <span class="nf">fallback_resources</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">18</span>     <span class="n">package_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">archive_path</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">archive</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:1082,</span> in <span class="ni">Path.__new__</span><span class="nt">(cls, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>     <span class="bp">cls</span> <span class="o">=</span> <span class="n">WindowsPath</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="n">PosixPath</span>
<span class="ne">-&gt; </span><span class="mi">1082</span> <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_parts</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1083</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flavour</span><span class="o">.</span><span class="n">is_supported</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>     <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cannot instantiate </span><span class="si">%r</span><span class="s2"> on your system&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1085</span>                               <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:707,</span> in <span class="ni">PurePath._from_parts</span><span class="nt">(cls, args, init)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span> <span class="k">def</span> <span class="nf">_from_parts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>     <span class="c1"># We need to call _parse_args on the instance, so as to get the</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="c1"># right flavour.</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">707</span>     <span class="n">drv</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_drv</span> <span class="o">=</span> <span class="n">drv</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:691,</span> in <span class="ni">PurePath._parse_args</span><span class="nt">(cls, args)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span>     <span class="n">parts</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">_parts</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">691</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>         <span class="c1"># Force-cast str subclasses to str (issue #21127)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>         <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="ne">TypeError</span>: expected str, bytes or os.PathLike object, not NoneType
</pre></div>
</div>
</div>
</div>
</section>
<section id="swimmer-agent-api">
<h2>1.3 Swimmer Agent API<a class="headerlink" href="#swimmer-agent-api" title="Permalink to this heading">#</a></h2>
<p>The observation space consists of 25 total dimensions, combining joint positions and body velocities, while the action space involves 5 dimensions representing normalized joint forces.</p>
<p><strong>Observation Space</strong>: 4k - 1 total (k = 6 <span class="math notranslate nohighlight">\(\rightarrow\)</span> 23)</p>
<ul class="simple">
<li><p>k - 1: joint positions <span class="math notranslate nohighlight">\(q_i \in [-\pi, \pi]\)</span> (<code class="docutils literal notranslate"><span class="pre">joints</span></code>)</p></li>
<li><p>3k: link linear velocities <span class="math notranslate nohighlight">\(vx_i, vy_i \in \mathbb{R}\)</span> and rotational velocity <span class="math notranslate nohighlight">\(wz_i \in \mathbb{R}\)</span> (<code class="docutils literal notranslate"><span class="pre">body_velocities</span></code>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">observation_spec</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OrderedDict([(&#39;joints&#39;,
              Array(shape=(5,), dtype=dtype(&#39;float64&#39;), name=&#39;joints&#39;)),
             (&#39;body_velocities&#39;,
              Array(shape=(18,), dtype=dtype(&#39;float64&#39;), name=&#39;body_velocities&#39;))])
</pre></div>
</div>
</div>
</div>
<p><strong>Action Space</strong>: k - 1 total (k = 6 <span class="math notranslate nohighlight">\(\rightarrow\)</span> 5)</p>
<ul class="simple">
<li><p>k - 1: joint normalized force <span class="math notranslate nohighlight">\(\ddot{q}_i \in [-1, 1]\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">action_spec</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BoundedArray(shape=(5,), dtype=dtype(&#39;float64&#39;), name=None, minimum=[-1. -1. -1. -1. -1.], maximum=[1. 1. 1. 1. 1.])
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-of-simple-modification-to-the-agent">
<h2>1.4 Example of simple modification to the agent<a class="headerlink" href="#example-of-simple-modification-to-the-agent" title="Permalink to this heading">#</a></h2>
<p>Let’s make a new swimmer agent with 12 links instead of 6, introducing complexity. Additionally, we have the flexibility to adjust various other parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@swimmer</span><span class="o">.</span><span class="n">SUITE</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">swim_12_links</span><span class="p">(</span>
  <span class="n">n_links</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
  <span class="n">desired_speed</span><span class="o">=</span><span class="n">_SWIM_SPEED</span><span class="p">,</span>
  <span class="n">time_limit</span><span class="o">=</span><span class="n">swimmer</span><span class="o">.</span><span class="n">_DEFAULT_TIME_LIMIT</span><span class="p">,</span>
  <span class="n">random</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">environment_kwargs</span><span class="o">=</span><span class="p">{},</span>
<span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Returns the Swim task for a n-link swimmer.&quot;&quot;&quot;</span>
  <span class="n">model_string</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="n">swimmer</span><span class="o">.</span><span class="n">get_model_and_assets</span><span class="p">(</span><span class="n">n_links</span><span class="p">)</span>
  <span class="n">physics</span> <span class="o">=</span> <span class="n">swimmer</span><span class="o">.</span><span class="n">Physics</span><span class="o">.</span><span class="n">from_xml_string</span><span class="p">(</span><span class="n">model_string</span><span class="p">,</span> <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">)</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">Swim</span><span class="p">(</span><span class="n">desired_speed</span><span class="o">=</span><span class="n">desired_speed</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="n">random</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">control</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">physics</span><span class="p">,</span>
    <span class="n">task</span><span class="p">,</span>
    <span class="n">time_limit</span><span class="o">=</span><span class="n">time_limit</span><span class="p">,</span>
    <span class="n">control_timestep</span><span class="o">=</span><span class="n">swimmer</span><span class="o">.</span><span class="n">_CONTROL_TIMESTEP</span><span class="p">,</span>
    <span class="o">**</span><span class="n">environment_kwargs</span><span class="p">,</span>
  <span class="p">)</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">suite</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;swimmer&#39;</span><span class="p">,</span> <span class="s1">&#39;swim_12_links&#39;</span><span class="p">,</span> <span class="n">task_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">test_dm_control</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">22</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>   <span class="k">return</span> <span class="n">control</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">physics</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">task</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="o">**</span><span class="n">environment_kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>   <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">env</span> <span class="o">=</span> <span class="n">suite</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;swimmer&#39;</span><span class="p">,</span> <span class="s1">&#39;swim_12_links&#39;</span><span class="p">,</span> <span class="n">task_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="ne">---&gt; </span><span class="mi">22</span> <span class="n">test_dm_control</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="nn">Cell In[10], line 18,</span> in <span class="ni">test_dm_control</span><span class="nt">(env)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">timestep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

<span class="nn">Cell In[8], line 58,</span> in <span class="ni">display_video</span><span class="nt">(frames, filename, fps, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># Write video to a temporary file.</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span> <span class="n">write_video</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">70</span>

<span class="nn">Cell In[8], line 34,</span> in <span class="ni">write_video</span><span class="nt">(filepath, frames, fps, macro_block_size, quality, verbose, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving video to:&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">34</span>   <span class="n">video</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/core/format.py:590,</span> in <span class="ni">Format.Writer.append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">im</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Call</span>
<span class="ne">--&gt; </span><span class="mi">590</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_data</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">total_meta</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:587,</span> in <span class="ni">FfmpegFormat.Writer._append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
<span class="ne">--&gt; </span><span class="mi">587</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Check size of image</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:648,</span> in <span class="ni">FfmpegFormat.Writer._initialize</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ffmpeg_api</span><span class="o">.</span><span class="n">write_frames</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">631</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">632</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="n">audio_codec</span><span class="o">=</span><span class="n">audio_codec</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span> <span class="c1"># Seed the generator (this is where the ffmpeg subprocess starts)</span>
<span class="ne">--&gt; </span><span class="mi">648</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:508,</span> in <span class="ni">write_frames</span><span class="nt">(path, size, pix_fmt_in, pix_fmt_out, fps, quality, bitrate, codec, macro_block_size, ffmpeg_log_level, ffmpeg_timeout, input_params, output_params, audio_path, audio_codec)</span>
<span class="g g-Whitespace">    </span><span class="mi">506</span>         <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;msmpeg4&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">508</span>         <span class="n">codec</span> <span class="o">=</span> <span class="n">get_first_available_h264_encoder</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span> <span class="n">audio_params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-an&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span> <span class="k">if</span> <span class="n">audio_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gif&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:124,</span> in <span class="ni">get_first_available_h264_encoder</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="nd">@lru_cache</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">def</span> <span class="nf">get_first_available_h264_encoder</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">124</span>     <span class="n">compiled_encoders</span> <span class="o">=</span> <span class="n">get_compiled_h264_encoders</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">compiled_encoders</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>         <span class="k">if</span> <span class="n">ffmpeg_test_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:58,</span> in <span class="ni">get_compiled_h264_encoders</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">get_compiled_h264_encoders</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_ffmpeg_exe</span><span class="p">(),</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-encoders&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>         <span class="n">cmd</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>         <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:28,</span> in <span class="ni">get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="k">return</span> <span class="n">exe</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="c1"># Auto-detect</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">_get_ffmpeg_exe</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">if</span> <span class="n">exe</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:44,</span> in <span class="ni">_get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">plat</span> <span class="o">=</span> <span class="n">get_platform</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># 2. Try from here</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_bin_dir</span><span class="p">(),</span> <span class="n">FNAME_PER_PLATFORM</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plat</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="k">if</span> <span class="n">exe</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_valid_exe</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:69,</span> in <span class="ni">_get_bin_dir</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>     <span class="n">ref</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">as_file</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="k">with</span> <span class="n">context</span> <span class="k">as</span> <span class="n">path</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/resources.py:147,</span> in <span class="ni">files</span><span class="nt">(package)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="n">Package</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">resources_abc</span><span class="o">.</span><span class="n">Traversable</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Get a Traversable resource from a package</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">147</span>     <span class="k">return</span> <span class="n">_common</span><span class="o">.</span><span class="n">from_package</span><span class="p">(</span><span class="n">_get_package</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:14,</span> in <span class="ni">from_package</span><span class="nt">(package)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">def</span> <span class="nf">from_package</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span><span class="sd">     Return a Traversable object for the given package.</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">14</span>     <span class="k">return</span> <span class="n">fallback_resources</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">__spec__</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:18,</span> in <span class="ni">fallback_resources</span><span class="nt">(spec)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="k">def</span> <span class="nf">fallback_resources</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">18</span>     <span class="n">package_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">archive_path</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">archive</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:1082,</span> in <span class="ni">Path.__new__</span><span class="nt">(cls, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>     <span class="bp">cls</span> <span class="o">=</span> <span class="n">WindowsPath</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="n">PosixPath</span>
<span class="ne">-&gt; </span><span class="mi">1082</span> <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_parts</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1083</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flavour</span><span class="o">.</span><span class="n">is_supported</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>     <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cannot instantiate </span><span class="si">%r</span><span class="s2"> on your system&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1085</span>                               <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:707,</span> in <span class="ni">PurePath._from_parts</span><span class="nt">(cls, args, init)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span> <span class="k">def</span> <span class="nf">_from_parts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>     <span class="c1"># We need to call _parse_args on the instance, so as to get the</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="c1"># right flavour.</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">707</span>     <span class="n">drv</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_drv</span> <span class="o">=</span> <span class="n">drv</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:691,</span> in <span class="ni">PurePath._parse_args</span><span class="nt">(cls, args)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span>     <span class="n">parts</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">_parts</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">691</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>         <span class="c1"># Force-cast str subclasses to str (issue #21127)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>         <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="ne">TypeError</span>: expected str, bytes or os.PathLike object, not NoneType
</pre></div>
</div>
</div>
</div>
<p>We can visualize this longer agent using our previously defined test_dm_control function.</p>
<p>❓</p>
<p>Using the API provided by Deepmind we can create any kind of changes to the agent and the environment.</p>
<p>Try to make the following changes to make yourself more familiar with the swimmer.</p>
<ul class="simple">
<li><p><em><strong>Adding a target (like a ball) to this environment at some x distance away from the agent.</strong></em></p></li>
<li><p><em><strong>Increasing the viscosity of the environment.</strong></em></p></li>
</ul>
<p>Have a look at the following links to see what kind of assets you will need to modify to make these changes.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/google-deepmind/dm_control/blob/main/dm_control/suite/swimmer.py">swimmer.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/google-deepmind/dm_control/blob/main/dm_control/suite/swimmer.xml">swimmer.xml</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add your code</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="section-2-training-models-on-the-swim-task">
<h1>Section 2: Training models on the swim task<a class="headerlink" href="#section-2-training-models-on-the-swim-task" title="Permalink to this heading">#</a></h1>
<p>To train the agents we defined in the previous section, we will utilize standard reinforcement learning (RL) algorithms. For the purposes of this tutorial, we will employ the <a class="reference external" href="https://github.com/fabiopardo/tonic">tonic_rl</a> library, which provides a robust framework for training RL agents. Throughout most of this project, you will primarily be modifying the environment or the model architecture. Therefore, I suggest treating these algorithms as a “black box” for now. Simply put, you input an untrained model, and the algorithm processes and returns a well-trained model. This approach allows us to focus on the impact of different architectures and environmental settings without delving deeply into the algorithmic complexities at this stage.</p>
<section id="download-and-install-tonic-library-for-training-agents">
<h2>Download and install tonic library for training agents<a class="headerlink" href="#download-and-install-tonic-library-for-training-agents" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Download and install tonic library for training agents</span>

<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span> <span class="c1">#to suppress output</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/divyansha1115/tonic.git
    <span class="o">%</span><span class="k">cd</span> tonic
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="section-2-1-defining-the-train-function">
<h2>Section 2.1 Defining the train function<a class="headerlink" href="#section-2-1-defining-the-train-function" title="Permalink to this heading">#</a></h2>
<p>First we defined a general training function to train any agent on any given environment with a variety of available algorithms. Given below are some of the parameter definitions of the function. You’ll likely want to adjust these parameters to customize the training process for an agent in a specific environment using your chosen algorithm from the tonic library:</p>
<ul class="simple">
<li><p><strong>Header</strong>: Python code required to run before training begins, primarily for importing essential libraries or modules.</p></li>
<li><p><strong>Agent</strong>: The agent that will undergo training; refer to section 3.2 and 4.2 for definitions of MLP and NCAP respectively.</p></li>
<li><p><strong>Environment</strong>: The training environment for the agent. Ensure it is registered with the DeepMind Control Suite as detailed in section 2.</p></li>
<li><p><strong>Name</strong>: The experiment’s name, which will be utilized for log and model saving purposes.</p></li>
<li><p><strong>Trainer</strong>: The trainer instance selected for use. It allows the configuration of the training steps, model saving frequency, and other training-related parameters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tonic</span>
<span class="kn">import</span> <span class="nn">tonic.torch</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
  <span class="n">header</span><span class="p">,</span>
  <span class="n">agent</span><span class="p">,</span>
  <span class="n">environment</span><span class="p">,</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
  <span class="n">trainer</span> <span class="o">=</span> <span class="s1">&#39;tonic.Trainer()&#39;</span><span class="p">,</span>
  <span class="n">before_training</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
  <span class="n">after_training</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
  <span class="n">parallel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="n">sequential</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Some additional parameters:</span>

<span class="sd">  - before_training: Python code to execute immediately before the training loop commences, suitable for setup actions needed after initialization but prior to training.</span>
<span class="sd">  - after_training: Python code to run once the training loop concludes, ideal for teardown or analytical purposes.</span>
<span class="sd">  - parallel: The count of environments to execute in parallel. Limited to 1 in a Colab notebook, but if additional resources are available, this number can be increased to expedite training.</span>
<span class="sd">  - sequential: The number of sequential steps the environment runs before sending observations back to the agent. This setting is useful for temporal batching. It can be disregarded for this tutorial&#39;s purposes.</span>
<span class="sd">  - seed: The experiment&#39;s random seed, guaranteeing the reproducibility of the training process.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Capture the arguments to save them, e.g. to play with the trained agent.</span>
  <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

  <span class="c1"># Run the header first, e.g. to load an ML framework.</span>
  <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

  <span class="c1"># Build the train and test environments.</span>
  <span class="n">_environment</span> <span class="o">=</span> <span class="n">environment</span>
  <span class="n">environment</span> <span class="o">=</span> <span class="n">tonic</span><span class="o">.</span><span class="n">environments</span><span class="o">.</span><span class="n">distribute</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">_environment</span><span class="p">),</span> <span class="n">parallel</span><span class="p">,</span> <span class="n">sequential</span><span class="p">)</span>
  <span class="n">test_environment</span> <span class="o">=</span> <span class="n">tonic</span><span class="o">.</span><span class="n">environments</span><span class="o">.</span><span class="n">distribute</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">_environment</span><span class="p">))</span>


  <span class="c1"># Build the agent.</span>
  <span class="n">agent</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
  <span class="n">agent</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span>
    <span class="n">observation_space</span><span class="o">=</span><span class="n">test_environment</span><span class="o">.</span><span class="n">observation_space</span><span class="p">,</span>
    <span class="n">action_space</span><span class="o">=</span><span class="n">test_environment</span><span class="o">.</span><span class="n">action_space</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

  <span class="c1"># Choose a name for the experiment.</span>
  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">test_environment</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="n">test_environment</span><span class="o">.</span><span class="n">name</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="n">test_environment</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">parallel</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">sequential</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">parallel</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">sequential</span><span class="si">}</span><span class="s1">&#39;</span>

  <span class="c1"># Initialize the logger to save data to the path environment/name/seed.</span>
  <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;experiments&#39;</span><span class="p">,</span> <span class="s1">&#39;tonic&#39;</span><span class="p">,</span> <span class="n">environment_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="n">tonic</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">script_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

  <span class="c1"># Build the trainer.</span>
  <span class="n">trainer</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>
  <span class="n">trainer</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
    <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
    <span class="n">test_environment</span><span class="o">=</span><span class="n">test_environment</span><span class="p">,</span>
  <span class="p">)</span>
  <span class="c1"># Run some code before training.</span>
  <span class="k">if</span> <span class="n">before_training</span><span class="p">:</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">before_training</span><span class="p">)</span>

  <span class="c1"># Train.</span>
  <span class="n">trainer</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

  <span class="c1"># Run some code after training.</span>
  <span class="k">if</span> <span class="n">after_training</span><span class="p">:</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">after_training</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="section-2-2-training-mlp-model-on-swim-task">
<h2>Section 2.2 Training MLP model on swim task<a class="headerlink" href="#section-2-2-training-mlp-model-on-swim-task" title="Permalink to this heading">#</a></h2>
<p>Now we are going to define a function for creating an actor-critic model suitable for Proximal Policy Optimization (PPO) using a Multi-Layer Perceptron (MLP) architecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tonic.torch</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">normalizers</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">ppo_mlp_model</span><span class="p">(</span>
  <span class="n">actor_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
  <span class="n">actor_activation</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">,</span>
  <span class="n">critic_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
  <span class="n">critic_activation</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Constructs an ActorCritic model with specified architectures for the actor and critic networks.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  - actor_sizes (tuple): Sizes of the layers in the actor MLP.</span>
<span class="sd">  - actor_activation (torch activation): Activation function used in the actor MLP.</span>
<span class="sd">  - critic_sizes (tuple): Sizes of the layers in the critic MLP.</span>
<span class="sd">  - critic_activation (torch activation): Activation function used in the critic MLP.</span>

<span class="sd">  Returns:</span>
<span class="sd">  - models.ActorCritic: An ActorCritic model comprising an actor and a critic with MLP torsos,</span>
<span class="sd">    equipped with a Gaussian policy head for the actor and a value head for the critic,</span>
<span class="sd">    along with observation normalization.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">ActorCritic</span><span class="p">(</span>
    <span class="n">actor</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span>
      <span class="n">encoder</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ObservationEncoder</span><span class="p">(),</span>
      <span class="n">torso</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="n">actor_sizes</span><span class="p">,</span> <span class="n">actor_activation</span><span class="p">),</span>
      <span class="n">head</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DetachedScaleGaussianPolicyHead</span><span class="p">(),</span>
    <span class="p">),</span>
    <span class="n">critic</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Critic</span><span class="p">(</span>
      <span class="n">encoder</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ObservationEncoder</span><span class="p">(),</span>
      <span class="n">torso</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="n">critic_sizes</span><span class="p">,</span> <span class="n">critic_activation</span><span class="p">),</span>
      <span class="n">head</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ValueHead</span><span class="p">(),</span>
    <span class="p">),</span>
    <span class="n">observation_normalizer</span><span class="o">=</span><span class="n">normalizers</span><span class="o">.</span><span class="n">MeanStd</span><span class="p">(),</span>
  <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we call the train function which initiates the training process for the provided agent using the Tonic library. It specifies the components necessary for training, including the model, environment, and training parameters:</p>
<p><strong>Agent</strong>: A Proximal Policy Optimization (PPO) agent with a custom Multi-Layer Perceptron (MLP) model architecture, configured with 256 units in each of two layers for both the actor and the critic.</p>
<p><strong>Environment</strong>: The training environment is set to “swimmer-swim” from the Control Suite, a benchmark suite for continuous control tasks.</p>
<p><strong>Name</strong>: The experiment is named ‘mlp_256’, which is useful for identifying logs and saved models associated with this training run.</p>
<p><strong>Trainer</strong>: Specifies the training configuration, including the total number of steps (5e5) and the frequency of saving the model (1e5 steps).</p>
<p><em>Note:</em> The model will checkpoint every ‘save_steps’ amount of training steps*</p>
<p>⏳</p>
<p>The model can take some time to train so feel free to skip the training for now. We have provided the pretrained model for you to play with. Move on to the next section to vizualize a agent with the pretrained model.</p>
<p>Uncomment the cell below if you want to perform the training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># with contextlib.redirect_stdout(io.StringIO()): #to suppress output</span>
<span class="c1">#     train(&#39;import tonic.torch&#39;,</span>
<span class="c1">#           &#39;tonic.torch.agents.PPO(model=ppo_mlp_model(actor_sizes=(256, 256), critic_sizes=(256,256)))&#39;,</span>
<span class="c1">#           &#39;tonic.environments.ControlSuite(&quot;swimmer-swim&quot;)&#39;,</span>
<span class="c1">#           name = &#39;mlp_256&#39;,</span>
<span class="c1">#           trainer = &#39;tonic.Trainer(steps=int(5e5),save_steps=int(1e5))&#39;</span>
<span class="c1">#     )</span>
</pre></div>
</div>
</div>
</div>
<p>❓</p>
<p><strong>Try playing with the parameters of the trainer and the MLP model and see how it affects the performance.</strong></p>
<ul class="simple">
<li><p><em><strong>How do the actor and the critic model size affect the performance.</strong></em></p></li>
<li><p><em><strong>Consider increasing the number of steps in trainer to train the model for longer.</strong></em></p></li>
<li><p><em><strong>Explore <a class="reference external" href="https://github.com/fabiopardo/tonic">Tonic library</a> to see what algorithms we can use to train our agents. (D4PG is usually faster than PPO)</strong></em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add your code</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="section-2-3-function-to-run-any-model-on-the-environment-and-generate-video">
<h2>Section 2.3 Function to run any model on the environment and generate video<a class="headerlink" href="#section-2-3-function-to-run-any-model-on-the-environment-and-generate-video" title="Permalink to this heading">#</a></h2>
<p>One of the most fun things about these environments is their visualization. We don’t want to just look at the reward to know how good our model is we want to see how well the agent swims. This is particularly important to avoid “reward hacking,” where an agent learns to exploit the reward system in ways that are unintended and potentially detrimental to the desired outcomes. Moreover visualizing the agent also help us understand where the model is going wrong.</p>
<p>Here we have defined a function that will generate the videos of the agent using the input model. The function requires path to the checkpoint folder and the environment you wanna run the trained model on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">play_model</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span><span class="n">environment</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plays a model within an environment and renders the gameplay to a video.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - path (str): Path to the directory containing the model and checkpoints.</span>
<span class="sd">    - checkpoint (str): Specifies which checkpoint to use (&#39;last&#39;, &#39;first&#39;, or a specific ID). &#39;none&#39; indicates no checkpoint.</span>
<span class="sd">    - environment (str): The environment to use. &#39;default&#39; uses the environment specified in the configuration file.</span>
<span class="sd">    - seed (int): Optional seed for reproducibility.</span>
<span class="sd">    - header (str): Optional Python code to execute before initializing the model, such as importing libraries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

  <span class="k">if</span> <span class="n">checkpoint</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
    <span class="c1"># Use no checkpoint, the agent is freshly created.</span>
    <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tonic</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Not loading any weights&#39;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;checkpoints&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">):</span>
      <span class="n">tonic</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">checkpoint_path</span><span class="si">}</span><span class="s1"> is not a directory&#39;</span><span class="p">)</span>
      <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># List all the checkpoints.</span>
    <span class="n">checkpoint_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">file</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;step_&#39;</span><span class="p">:</span>
        <span class="n">checkpoint_id</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">checkpoint_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">checkpoint_id</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))</span>

    <span class="k">if</span> <span class="n">checkpoint_ids</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">checkpoint</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
        <span class="c1"># Use the last checkpoint.</span>
        <span class="n">checkpoint_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">checkpoint_ids</span><span class="p">)</span>
        <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;step_</span><span class="si">{</span><span class="n">checkpoint_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">checkpoint</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span>
        <span class="c1"># Use the first checkpoint.</span>
        <span class="n">checkpoint_id</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">checkpoint_ids</span><span class="p">)</span>
        <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;step_</span><span class="si">{</span><span class="n">checkpoint_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use the specified checkpoint.</span>
        <span class="n">checkpoint_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checkpoint_id</span> <span class="ow">in</span> <span class="n">checkpoint_ids</span><span class="p">:</span>
          <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;step_</span><span class="si">{</span><span class="n">checkpoint_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">tonic</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checkpoint </span><span class="si">{</span><span class="n">checkpoint_id</span><span class="si">}</span><span class="s1"> not found in </span><span class="si">{</span><span class="n">checkpoint_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
          <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">tonic</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No checkpoint found in </span><span class="si">{</span><span class="n">checkpoint_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="c1"># Load the experiment configuration.</span>
  <span class="n">arguments_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;config.yaml&#39;</span><span class="p">)</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">arguments_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
  <span class="n">config</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>

  <span class="c1"># Run the header first, e.g. to load an ML framework.</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
      <span class="n">exec</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
      <span class="n">exec</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="c1"># Build the agent.</span>
  <span class="n">agent</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">agent</span><span class="p">)</span>

  <span class="c1"># Build the environment.</span>
  <span class="k">if</span> <span class="n">environment</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
    <span class="n">environment</span>  <span class="o">=</span> <span class="n">tonic</span><span class="o">.</span><span class="n">environments</span><span class="o">.</span><span class="n">distribute</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">environment</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">environment</span>  <span class="o">=</span> <span class="n">tonic</span><span class="o">.</span><span class="n">environments</span><span class="o">.</span><span class="n">distribute</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">environment</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">environment</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

  <span class="c1"># Initialize the agent.</span>
  <span class="n">agent</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span>
    <span class="n">observation_space</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">observation_space</span><span class="p">,</span>
    <span class="n">action_space</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">action_space</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="c1"># Load the weights of the agent form a checkpoint.</span>
  <span class="k">if</span> <span class="n">checkpoint_path</span><span class="p">:</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">)</span>

  <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">test_observations</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">environment</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;rgb_array&#39;</span><span class="p">,</span><span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
  <span class="n">score</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="c1"># Select an action.</span>
      <span class="n">actions</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">test_step</span><span class="p">(</span><span class="n">test_observations</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
      <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

      <span class="c1"># Take a step in the environment.</span>
      <span class="n">test_observations</span><span class="p">,</span> <span class="n">infos</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
      <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;rgb_array&#39;</span><span class="p">,</span><span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">agent</span><span class="o">.</span><span class="n">test_update</span><span class="p">(</span><span class="o">**</span><span class="n">infos</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>

      <span class="n">score</span> <span class="o">+=</span> <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;rewards&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>

      <span class="k">if</span> <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;resets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
          <span class="k">break</span>
  <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reward for the run: &#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span><span class="n">video_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize the agent with a pretrained MLP model. Once you have your pretrained model, you can replace the experiment path to visualize the agent with your model.</p>
<p>⏳</p>
<section id="uncomment-and-use-gpu-to-observe-video">
<h3>Uncomment and use GPU to observe video<a class="headerlink" href="#uncomment-and-use-gpu-to-observe-video" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Uncomment and use GPU to observe video</span>
<span class="c1"># play_model(&#39;data/local/experiments/tonic/swimmer-swim/mlp_256&#39;)</span>
<span class="n">play_model</span><span class="p">(</span><span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_mlp_ppo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold -Color-Bold-Green">Loading weights from data/local/experiments/tonic/swimmer-swim/pretrained_mlp_ppo/checkpoints/step_10000000.pt</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reward for the run:  992.220383785665
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#@title Uncomment and use GPU to observe video</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># play_model(&#39;data/local/experiments/tonic/swimmer-swim/mlp_256&#39;)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">play_model</span><span class="p">(</span><span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_mlp_ppo&#39;</span><span class="p">)</span>

<span class="nn">Cell In[21], line 111,</span> in <span class="ni">play_model</span><span class="nt">(path, checkpoint, environment, seed, header)</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span> <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reward for the run: &#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">111</span> <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span><span class="n">video_path</span><span class="p">)</span>

<span class="nn">Cell In[8], line 58,</span> in <span class="ni">display_video</span><span class="nt">(frames, filename, fps, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># Write video to a temporary file.</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span> <span class="n">write_video</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">70</span>

<span class="nn">Cell In[8], line 34,</span> in <span class="ni">write_video</span><span class="nt">(filepath, frames, fps, macro_block_size, quality, verbose, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving video to:&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">34</span>   <span class="n">video</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/core/format.py:590,</span> in <span class="ni">Format.Writer.append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">im</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Call</span>
<span class="ne">--&gt; </span><span class="mi">590</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_data</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">total_meta</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:587,</span> in <span class="ni">FfmpegFormat.Writer._append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
<span class="ne">--&gt; </span><span class="mi">587</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Check size of image</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:648,</span> in <span class="ni">FfmpegFormat.Writer._initialize</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ffmpeg_api</span><span class="o">.</span><span class="n">write_frames</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">631</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">632</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="n">audio_codec</span><span class="o">=</span><span class="n">audio_codec</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span> <span class="c1"># Seed the generator (this is where the ffmpeg subprocess starts)</span>
<span class="ne">--&gt; </span><span class="mi">648</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:508,</span> in <span class="ni">write_frames</span><span class="nt">(path, size, pix_fmt_in, pix_fmt_out, fps, quality, bitrate, codec, macro_block_size, ffmpeg_log_level, ffmpeg_timeout, input_params, output_params, audio_path, audio_codec)</span>
<span class="g g-Whitespace">    </span><span class="mi">506</span>         <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;msmpeg4&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">508</span>         <span class="n">codec</span> <span class="o">=</span> <span class="n">get_first_available_h264_encoder</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span> <span class="n">audio_params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-an&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span> <span class="k">if</span> <span class="n">audio_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gif&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:124,</span> in <span class="ni">get_first_available_h264_encoder</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="nd">@lru_cache</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">def</span> <span class="nf">get_first_available_h264_encoder</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">124</span>     <span class="n">compiled_encoders</span> <span class="o">=</span> <span class="n">get_compiled_h264_encoders</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">compiled_encoders</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>         <span class="k">if</span> <span class="n">ffmpeg_test_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:58,</span> in <span class="ni">get_compiled_h264_encoders</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">get_compiled_h264_encoders</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_ffmpeg_exe</span><span class="p">(),</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-encoders&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>         <span class="n">cmd</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>         <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:28,</span> in <span class="ni">get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="k">return</span> <span class="n">exe</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="c1"># Auto-detect</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">_get_ffmpeg_exe</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">if</span> <span class="n">exe</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:44,</span> in <span class="ni">_get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">plat</span> <span class="o">=</span> <span class="n">get_platform</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># 2. Try from here</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_bin_dir</span><span class="p">(),</span> <span class="n">FNAME_PER_PLATFORM</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plat</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="k">if</span> <span class="n">exe</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_valid_exe</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:69,</span> in <span class="ni">_get_bin_dir</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>     <span class="n">ref</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">as_file</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="k">with</span> <span class="n">context</span> <span class="k">as</span> <span class="n">path</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/resources.py:147,</span> in <span class="ni">files</span><span class="nt">(package)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="n">Package</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">resources_abc</span><span class="o">.</span><span class="n">Traversable</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Get a Traversable resource from a package</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">147</span>     <span class="k">return</span> <span class="n">_common</span><span class="o">.</span><span class="n">from_package</span><span class="p">(</span><span class="n">_get_package</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:14,</span> in <span class="ni">from_package</span><span class="nt">(package)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">def</span> <span class="nf">from_package</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span><span class="sd">     Return a Traversable object for the given package.</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">14</span>     <span class="k">return</span> <span class="n">fallback_resources</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">__spec__</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:18,</span> in <span class="ni">fallback_resources</span><span class="nt">(spec)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="k">def</span> <span class="nf">fallback_resources</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">18</span>     <span class="n">package_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">archive_path</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">archive</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:1082,</span> in <span class="ni">Path.__new__</span><span class="nt">(cls, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>     <span class="bp">cls</span> <span class="o">=</span> <span class="n">WindowsPath</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="n">PosixPath</span>
<span class="ne">-&gt; </span><span class="mi">1082</span> <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_parts</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1083</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flavour</span><span class="o">.</span><span class="n">is_supported</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>     <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cannot instantiate </span><span class="si">%r</span><span class="s2"> on your system&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1085</span>                               <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:707,</span> in <span class="ni">PurePath._from_parts</span><span class="nt">(cls, args, init)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span> <span class="k">def</span> <span class="nf">_from_parts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>     <span class="c1"># We need to call _parse_args on the instance, so as to get the</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="c1"># right flavour.</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">707</span>     <span class="n">drv</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_drv</span> <span class="o">=</span> <span class="n">drv</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:691,</span> in <span class="ni">PurePath._parse_args</span><span class="nt">(cls, args)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span>     <span class="n">parts</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">_parts</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">691</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>         <span class="c1"># Force-cast str subclasses to str (issue #21127)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>         <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="ne">TypeError</span>: expected str, bytes or os.PathLike object, not NoneType
</pre></div>
</div>
</div>
</div>
<p>❓</p>
<p>Try testing the model on a modification of the enviroment it was trained on.</p>
<ul class="simple">
<li><p><em><strong>Train on basic swim task and test on a environment with higher viscosity.</strong></em></p></li>
<li><p><em><strong>Can we train on the basic 6 link swimmer and test on a larger 12 link swimmer?</strong></em></p></li>
<li><p><em><strong>Train the model for a bit on the modified environment and see how quickly the model can adapt to the new environment.</strong></em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add your code</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="section-3-ncap">
<h1>Section 3: NCAP<a class="headerlink" href="#section-3-ncap" title="Permalink to this heading">#</a></h1>
<p>Now that we are familiar with how to train standard models on the swimmer agent let’s take a look at NCAP a model that was inspired from the C. elegans motor circuit.
Our hope with using such models is that they would already have really good priors which should lead to much better transfer, faster learning curves and possibly really good innate performance (zero shot performance).</p>
<p>Check out <a class="reference external" href="https://arxiv.org/abs/2201.05242">NCAP paper</a> to learn more about the model.</p>
<section id="paper-illustration">
<h2>Paper Illustration<a class="headerlink" href="#paper-illustration" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Paper Illustration</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/neuromatch/NeuroAI_Course/blob/main/projects/project-notebooks/static/NCAPPaper.png?raw=true&quot;</span>

<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://github.com/neuromatch/NeuroAI_Course/blob/main/projects/project-notebooks/static/NCAPPaper.png?raw=true"/></div></div>
</div>
</section>
<section id="ncap-classes">
<h2>3.1 NCAP classes<a class="headerlink" href="#ncap-classes" title="Permalink to this heading">#</a></h2>
<p>Now we are going to define <em><strong>SwimmerModule</strong></em> (NCAP model) and <em><strong>SwimmerActor</strong></em> (wrapper around NCAP model to make it compatible with tonic) classes.</p>
<section id="section-3-1-1-defining-the-constraints">
<h3>Section 3.1.1 Defining the constraints<a class="headerlink" href="#section-3-1-1-defining-the-constraints" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==================================================================================================</span>
<span class="c1"># Weight constraints.</span>


<span class="k">def</span> <span class="nf">excitatory</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">inhibitory</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unsigned</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">w</span> <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">w</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="c1"># ==================================================================================================</span>
<span class="c1"># Activation constraints.</span>


<span class="k">def</span> <span class="nf">graded</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># ==================================================================================================</span>
<span class="c1"># Weight initialization.</span>


<span class="k">def</span> <span class="nf">excitatory_uniform</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">lower</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)),</span> <span class="n">a</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">inhibitory_uniform</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">upper</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)),</span> <span class="n">a</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unsigned_uniform</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)),</span> <span class="n">a</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">excitatory_constant</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">inhibitory_constant</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">value</span><span class="o">=-</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">unsigned_constant</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">p</span>
        <span class="n">weight</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper</span>
        <span class="n">weight</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span>
        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Can you think of more kinds of weight initializations and constraints that might be useful for the swimmer agent?</strong></em></p>
</section>
<section id="section-3-1-2-defining-the-swimmermodule">
<h3>Section 3.1.2: Defining the <em><strong>SwimmerModule</strong></em><a class="headerlink" href="#section-3-1-2-defining-the-swimmermodule" title="Permalink to this heading">#</a></h3>
<p>The <em><strong>SwimmerModule</strong></em> class represents the neural network module inspired by the C. elegans neural circuitry, designed for controlling a robotic swimmer with specific architectural priors, such as proprioception and oscillatory movement patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SwimmerModule</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;C.-elegans-inspired neural circuit architectural prior.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">n_joints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">n_turn_joints</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">oscillator_period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
            <span class="n">use_weight_sharing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">use_weight_constraints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">use_weight_constant_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">include_proprioception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">include_head_oscillators</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">include_speed_control</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">include_turn_control</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_joints</span> <span class="o">=</span> <span class="n">n_joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_turn_joints</span> <span class="o">=</span> <span class="n">n_turn_joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oscillator_period</span> <span class="o">=</span> <span class="n">oscillator_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_proprioception</span> <span class="o">=</span> <span class="n">include_proprioception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_head_oscillators</span> <span class="o">=</span> <span class="n">include_head_oscillators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_speed_control</span> <span class="o">=</span> <span class="n">include_speed_control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_turn_control</span> <span class="o">=</span> <span class="n">include_turn_control</span>

        <span class="c1"># Log activity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections_log</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Timestep counter (for oscillations).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Weight sharing switch function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">nonshared</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">shared</span> <span class="k">if</span> <span class="n">use_weight_sharing</span> <span class="k">else</span> <span class="n">nonshared</span>

        <span class="c1"># Weight constraint and init functions.</span>
        <span class="k">if</span> <span class="n">use_weight_constraints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exc</span> <span class="o">=</span> <span class="n">excitatory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inh</span> <span class="o">=</span> <span class="n">inhibitory</span>
            <span class="k">if</span> <span class="n">use_weight_constant_init</span><span class="p">:</span>
                <span class="n">exc_param</span> <span class="o">=</span> <span class="n">excitatory_constant</span>
                <span class="n">inh_param</span> <span class="o">=</span> <span class="n">inhibitory_constant</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exc_param</span> <span class="o">=</span> <span class="n">excitatory_uniform</span>
                <span class="n">inh_param</span> <span class="o">=</span> <span class="n">inhibitory_uniform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exc</span> <span class="o">=</span> <span class="n">unsigned</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inh</span> <span class="o">=</span> <span class="n">unsigned</span>
            <span class="k">if</span> <span class="n">use_weight_constant_init</span><span class="p">:</span>
                <span class="n">exc_param</span> <span class="o">=</span> <span class="n">inh_param</span> <span class="o">=</span> <span class="n">unsigned_constant</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exc_param</span> <span class="o">=</span> <span class="n">inh_param</span> <span class="o">=</span> <span class="n">unsigned_uniform</span>

        <span class="c1"># Learnable parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">use_weight_sharing</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_proprioception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bneuron_prop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_speed_control</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bneuron_speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_turn_control</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bneuron_turn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_head_oscillators</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bneuron_osc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;muscle_ipsi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;muscle_contra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_joints</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_proprioception</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_speed_control</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_turn_control</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_turn_joints</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_head_oscillators</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;muscle_d_d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;muscle_d_v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;muscle_v_v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc_param</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;muscle_v_d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inh_param</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">log_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_type</span><span class="p">,</span> <span class="n">neuron</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Logs an active connection between neurons.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">activity_type</span><span class="p">,</span> <span class="n">neuron</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">joint_pos</span><span class="p">,</span>
            <span class="n">right_control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">left_control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">speed_control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">log_activity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">log_file</span><span class="o">=</span><span class="s1">&#39;log.txt&#39;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward pass.</span>

<span class="sd">    Args:</span>
<span class="sd">      joint_pos (torch.Tensor): Joint positions in [-1, 1], shape (..., n_joints).</span>
<span class="sd">      right_control (torch.Tensor): Right turn control in [0, 1], shape (..., 1).</span>
<span class="sd">      left_control (torch.Tensor): Left turn control in [0, 1], shape (..., 1).</span>
<span class="sd">      speed_control (torch.Tensor): Speed control in [0, 1], 0 stopped, 1 fastest, shape (..., 1).</span>
<span class="sd">      timesteps (torch.Tensor): Timesteps in [0, max_env_steps], shape (..., 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">      (torch.Tensor): Joint torques in [-1, 1], shape (..., n_joints).</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="n">exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exc</span>
        <span class="n">inh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inh</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span>

        <span class="c1"># Separate into dorsal and ventral sensor values in [0, 1], shape (..., n_joints).</span>
        <span class="n">joint_pos_d</span> <span class="o">=</span> <span class="n">joint_pos</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">joint_pos_v</span> <span class="o">=</span> <span class="n">joint_pos</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">neg</span><span class="p">()</span>

        <span class="c1"># Convert speed signal from acceleration into brake.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_speed_control</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">speed_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">speed_control</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">speed_control</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">joint_torques</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [shape (..., 1)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_joints</span><span class="p">):</span>
            <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">joint_pos</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>  <span class="c1"># shape (..., 1)</span>

            <span class="c1"># B-neurons recieve proprioceptive input from previous joint to propagate waves down the body.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_proprioception</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">bneuron_d</span> <span class="o">+</span> <span class="n">joint_pos_d</span><span class="p">[</span>
                    <span class="o">...</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_prop&#39;</span><span class="p">)])</span>
                <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">bneuron_v</span> <span class="o">+</span> <span class="n">joint_pos_v</span><span class="p">[</span>
                    <span class="o">...</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_prop&#39;</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_d_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_v_prop_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Speed control unit modulates all B-neurons.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_speed_control</span><span class="p">:</span>
                <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">bneuron_d</span> <span class="o">+</span> <span class="n">speed_control</span> <span class="o">*</span> <span class="n">inh</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_speed&#39;</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">bneuron_v</span> <span class="o">+</span> <span class="n">speed_control</span> <span class="o">*</span> <span class="n">inh</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_speed&#39;</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;inh&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_d_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;inh&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_v_speed_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Turn control units modulate head B-neurons.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_turn_control</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_turn_joints</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">right_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">assert</span> <span class="n">left_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">turn_control_d</span> <span class="o">=</span> <span class="n">right_control</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape (..., 1)</span>
                <span class="n">turn_control_v</span> <span class="o">=</span> <span class="n">left_control</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">bneuron_d</span> <span class="o">+</span> <span class="n">turn_control_d</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_turn&#39;</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">bneuron_v</span> <span class="o">+</span> <span class="n">turn_control_v</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_turn&#39;</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_d_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_v_turn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Oscillator units modulate first B-neurons.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_head_oscillators</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="n">timesteps</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oscillator_period</span><span class="p">)</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscillator_period</span> <span class="o">//</span> <span class="mi">2</span>
                    <span class="n">oscillator_d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span>  <span class="c1"># shape (..., 1)</span>
                    <span class="n">oscillator_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span>  <span class="c1"># shape (..., 1)</span>
                    <span class="n">oscillator_d</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
                    <span class="n">oscillator_v</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscillator_period</span>  <span class="c1"># in [0, oscillator_period)</span>
                    <span class="k">if</span> <span class="n">phase</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscillator_period</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">oscillator_d</span><span class="p">,</span> <span class="n">oscillator_v</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">oscillator_d</span><span class="p">,</span> <span class="n">oscillator_v</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span>
                <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">bneuron_d</span> <span class="o">+</span> <span class="n">oscillator_d</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_d_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_osc&#39;</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">bneuron_v</span> <span class="o">+</span> <span class="n">oscillator_v</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bneuron_v_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;bneuron_osc&#39;</span><span class="p">)]</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_d_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_activity</span><span class="p">(</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bneuron_v_osc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># B-neuron activation.</span>
            <span class="n">bneuron_d</span> <span class="o">=</span> <span class="n">graded</span><span class="p">(</span><span class="n">bneuron_d</span><span class="p">)</span>
            <span class="n">bneuron_v</span> <span class="o">=</span> <span class="n">graded</span><span class="p">(</span><span class="n">bneuron_v</span><span class="p">)</span>

            <span class="c1"># Muscles receive excitatory ipsilateral and inhibitory contralateral input.</span>
            <span class="n">muscle_d</span> <span class="o">=</span> <span class="n">graded</span><span class="p">(</span>
                <span class="n">bneuron_d</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;muscle_d_d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;muscle_ipsi&#39;</span><span class="p">)])</span> <span class="o">+</span>
                <span class="n">bneuron_v</span> <span class="o">*</span> <span class="n">inh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;muscle_d_v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;muscle_contra&#39;</span><span class="p">)])</span>
            <span class="p">)</span>
            <span class="n">muscle_v</span> <span class="o">=</span> <span class="n">graded</span><span class="p">(</span>
                <span class="n">bneuron_v</span> <span class="o">*</span> <span class="n">exc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;muscle_v_v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;muscle_ipsi&#39;</span><span class="p">)])</span> <span class="o">+</span>
                <span class="n">bneuron_d</span> <span class="o">*</span> <span class="n">inh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">ws</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;muscle_v_d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;muscle_contra&#39;</span><span class="p">)])</span>
            <span class="p">)</span>

            <span class="c1"># Joint torque from antagonistic contraction of dorsal and ventral muscles.</span>
            <span class="n">joint_torque</span> <span class="o">=</span> <span class="n">muscle_d</span> <span class="o">-</span> <span class="n">muscle_v</span>
            <span class="n">joint_torques</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">joint_torque</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">joint_torques</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape (..., n_joints)</span>
        <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="section-3-1-3-defining-the-swimmeractor-wrapper">
<h3>Section 3.1.3: Defining the <em><strong>SwimmerActor</strong></em> wrapper<a class="headerlink" href="#section-3-1-3-defining-the-swimmeractor-wrapper" title="Permalink to this heading">#</a></h3>
<p>The <em><strong>SwimmerActor</strong></em> class acts as a wrapper around the <em><strong>SwimmerModule</strong></em>, managing high-level control signals and observations coming from the environment and passing them to the <em><strong>SwimmerModule</strong></em> in a suitable format. This class is basically responsible for making the SwimmerModule compatible with the tonic library. If you wish to use any other library to try a algorithm not present in tonic you have to write a new wrapper to make <em><strong>SwimmerModule</strong></em> compatible with that library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SwimmerActor</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">swimmer</span><span class="p">,</span>
            <span class="n">controller</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timestep_transform</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swimmer</span> <span class="o">=</span> <span class="n">swimmer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">distribution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep_transform</span> <span class="o">=</span> <span class="n">timestep_transform</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">observation_space</span><span class="p">,</span>
            <span class="n">action_space</span><span class="p">,</span>
            <span class="n">observation_normalizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_size</span> <span class="o">=</span> <span class="n">action_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">):</span>
        <span class="n">joint_pos</span> <span class="o">=</span> <span class="n">observations</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">action_size</span><span class="p">]</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="n">observations</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Normalize joint positions by max joint angle (in radians).</span>
        <span class="n">joint_limit</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># In dm_control, calculated with n_bodies.</span>
        <span class="n">joint_pos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">joint_pos</span> <span class="o">/</span> <span class="n">joint_limit</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Convert normalized time signal into timestep.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_transform</span><span class="p">:</span>
            <span class="n">low_in</span><span class="p">,</span> <span class="n">high_in</span><span class="p">,</span> <span class="n">low_out</span><span class="p">,</span> <span class="n">high_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_transform</span>
            <span class="n">timesteps</span> <span class="o">=</span> <span class="p">(</span><span class="n">timesteps</span> <span class="o">-</span> <span class="n">low_in</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">high_in</span> <span class="o">-</span> <span class="n">low_in</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">high_out</span> <span class="o">-</span> <span class="n">low_out</span><span class="p">)</span> <span class="o">+</span> <span class="n">low_out</span>

        <span class="c1"># Generate high-level control signals.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">:</span>
            <span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Generate low-level action signals.</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swimmer</span><span class="p">(</span>
            <span class="n">joint_pos</span><span class="p">,</span>
            <span class="n">timesteps</span><span class="o">=</span><span class="n">timesteps</span><span class="p">,</span>
            <span class="n">right_control</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
            <span class="n">left_control</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
            <span class="n">speed_control</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Pass through distribution for stochastic policy.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="p">:</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">actions</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="train-ncap">
<h2>3.2: Train NCAP<a class="headerlink" href="#train-ncap" title="Permalink to this heading">#</a></h2>
<p>We will now define functions akin to those for MLP we defined in Section 3.2, but tailored for the SwimmerActor model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tonic.torch</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">normalizers</span>
<span class="kn">import</span> <span class="nn">torch</span>


<span class="k">def</span> <span class="nf">ppo_swimmer_model</span><span class="p">(</span>
        <span class="n">n_joints</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">action_noise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">critic_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
        <span class="n">critic_activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">,</span>
        <span class="o">**</span><span class="n">swimmer_kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">ActorCritic</span><span class="p">(</span>
        <span class="n">actor</span><span class="o">=</span><span class="n">SwimmerActor</span><span class="p">(</span>
            <span class="n">swimmer</span><span class="o">=</span><span class="n">SwimmerModule</span><span class="p">(</span><span class="n">n_joints</span><span class="o">=</span><span class="n">n_joints</span><span class="p">,</span> <span class="o">**</span><span class="n">swimmer_kwargs</span><span class="p">),</span>
            <span class="n">distribution</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">action_noise</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">critic</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Critic</span><span class="p">(</span>
            <span class="n">encoder</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ObservationEncoder</span><span class="p">(),</span>
            <span class="n">torso</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="n">critic_sizes</span><span class="p">,</span> <span class="n">critic_activation</span><span class="p">),</span>
            <span class="n">head</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ValueHead</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="n">observation_normalizer</span><span class="o">=</span><span class="n">normalizers</span><span class="o">.</span><span class="n">MeanStd</span><span class="p">(),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">d4pg_swimmer_model</span><span class="p">(</span>
  <span class="n">n_joints</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">critic_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
  <span class="n">critic_activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
  <span class="o">**</span><span class="n">swimmer_kwargs</span><span class="p">,</span>
<span class="p">):</span>
  <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">ActorCriticWithTargets</span><span class="p">(</span>
    <span class="n">actor</span><span class="o">=</span><span class="n">SwimmerActor</span><span class="p">(</span><span class="n">swimmer</span><span class="o">=</span><span class="n">SwimmerModule</span><span class="p">(</span><span class="n">n_joints</span><span class="o">=</span><span class="n">n_joints</span><span class="p">,</span> <span class="o">**</span><span class="n">swimmer_kwargs</span><span class="p">),),</span>
    <span class="n">critic</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Critic</span><span class="p">(</span>
      <span class="n">encoder</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ObservationActionEncoder</span><span class="p">(),</span>
      <span class="n">torso</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="n">critic_sizes</span><span class="p">,</span> <span class="n">critic_activation</span><span class="p">),</span>
      <span class="c1"># These values are for the control suite with 0.99 discount.</span>
      <span class="n">head</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DistributionalValueHead</span><span class="p">(</span><span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="mf">150.</span><span class="p">,</span> <span class="mi">51</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">observation_normalizer</span><span class="o">=</span><span class="n">normalizers</span><span class="o">.</span><span class="n">MeanStd</span><span class="p">(),</span>
  <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>⏳</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span> <span class="c1">#to suppress output</span>

    <span class="n">train</span><span class="p">(</span><span class="s1">&#39;import tonic.torch&#39;</span><span class="p">,</span>
          <span class="c1"># &#39;tonic.torch.agents.D4PG(model=d4pg_swimmer_model(n_joints=5,critic_sizes=(128,128)))&#39;,</span>
          <span class="s1">&#39;tonic.torch.agents.PPO(model=ppo_swimmer_model(n_joints=5,critic_sizes=(256,256)))&#39;</span><span class="p">,</span>
      <span class="s1">&#39;tonic.environments.ControlSuite(&quot;swimmer-swim&quot;,time_feature=True)&#39;</span><span class="p">,</span>
      <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ncap_ppo&#39;</span><span class="p">,</span>
      <span class="n">trainer</span> <span class="o">=</span> <span class="s1">&#39;tonic.Trainer(steps=int(1e5),save_steps=int(5e4))&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Let’s visualize the trained NCAP agent in the environment.</p>
<p>⏳</p>
<section id="id1">
<h3>Uncomment and use GPU to observe video<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Uncomment and use GPU to observe video</span>
<span class="c1"># play_model(&#39;data/local/experiments/tonic/swimmer-swim/ncap_ppo&#39;)</span>
<span class="n">play_model</span><span class="p">(</span><span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_ncap_ppo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold -Color-Bold-Green">Loading weights from data/local/experiments/tonic/swimmer-swim/pretrained_ncap_ppo/checkpoints/step_10000000.pt</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reward for the run:  915.6788633875549
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#@title Uncomment and use GPU to observe video</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># play_model(&#39;data/local/experiments/tonic/swimmer-swim/ncap_ppo&#39;)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">play_model</span><span class="p">(</span><span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_ncap_ppo&#39;</span><span class="p">)</span>

<span class="nn">Cell In[21], line 111,</span> in <span class="ni">play_model</span><span class="nt">(path, checkpoint, environment, seed, header)</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span> <span class="n">video_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reward for the run: &#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">111</span> <span class="k">return</span> <span class="n">display_video</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span><span class="n">video_path</span><span class="p">)</span>

<span class="nn">Cell In[8], line 58,</span> in <span class="ni">display_video</span><span class="nt">(frames, filename, fps, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># Write video to a temporary file.</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span> <span class="n">write_video</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">70</span>

<span class="nn">Cell In[8], line 34,</span> in <span class="ni">write_video</span><span class="nt">(filepath, frames, fps, macro_block_size, quality, verbose, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving video to:&#39;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">34</span>   <span class="n">video</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/core/format.py:590,</span> in <span class="ni">Format.Writer.append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">im</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Call</span>
<span class="ne">--&gt; </span><span class="mi">590</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_data</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">total_meta</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:587,</span> in <span class="ni">FfmpegFormat.Writer._append_data</span><span class="nt">(self, im, meta)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
<span class="ne">--&gt; </span><span class="mi">587</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span> <span class="c1"># Check size of image</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio/plugins/ffmpeg.py:648,</span> in <span class="ni">FfmpegFormat.Writer._initialize</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ffmpeg_api</span><span class="o">.</span><span class="n">write_frames</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">631</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">632</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="n">audio_codec</span><span class="o">=</span><span class="n">audio_codec</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span> <span class="c1"># Seed the generator (this is where the ffmpeg subprocess starts)</span>
<span class="ne">--&gt; </span><span class="mi">648</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:508,</span> in <span class="ni">write_frames</span><span class="nt">(path, size, pix_fmt_in, pix_fmt_out, fps, quality, bitrate, codec, macro_block_size, ffmpeg_log_level, ffmpeg_timeout, input_params, output_params, audio_path, audio_codec)</span>
<span class="g g-Whitespace">    </span><span class="mi">506</span>         <span class="n">codec</span> <span class="o">=</span> <span class="s2">&quot;msmpeg4&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">508</span>         <span class="n">codec</span> <span class="o">=</span> <span class="n">get_first_available_h264_encoder</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span> <span class="n">audio_params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-an&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span> <span class="k">if</span> <span class="n">audio_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gif&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:124,</span> in <span class="ni">get_first_available_h264_encoder</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="nd">@lru_cache</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">def</span> <span class="nf">get_first_available_h264_encoder</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">124</span>     <span class="n">compiled_encoders</span> <span class="o">=</span> <span class="n">get_compiled_h264_encoders</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">compiled_encoders</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>         <span class="k">if</span> <span class="n">ffmpeg_test_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_io.py:58,</span> in <span class="ni">get_compiled_h264_encoders</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">get_compiled_h264_encoders</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_ffmpeg_exe</span><span class="p">(),</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-encoders&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>         <span class="n">cmd</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>         <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:28,</span> in <span class="ni">get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="k">return</span> <span class="n">exe</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="c1"># Auto-detect</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">_get_ffmpeg_exe</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">if</span> <span class="n">exe</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:44,</span> in <span class="ni">_get_ffmpeg_exe</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">plat</span> <span class="o">=</span> <span class="n">get_platform</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># 2. Try from here</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">exe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_bin_dir</span><span class="p">(),</span> <span class="n">FNAME_PER_PLATFORM</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plat</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="k">if</span> <span class="n">exe</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_valid_exe</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="k">return</span> <span class="n">exe</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/imageio_ffmpeg/_utils.py:69,</span> in <span class="ni">_get_bin_dir</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>     <span class="n">ref</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;imageio_ffmpeg.binaries&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">context</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">as_file</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="k">with</span> <span class="n">context</span> <span class="k">as</span> <span class="n">path</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/resources.py:147,</span> in <span class="ni">files</span><span class="nt">(package)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="n">Package</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">resources_abc</span><span class="o">.</span><span class="n">Traversable</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Get a Traversable resource from a package</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">147</span>     <span class="k">return</span> <span class="n">_common</span><span class="o">.</span><span class="n">from_package</span><span class="p">(</span><span class="n">_get_package</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:14,</span> in <span class="ni">from_package</span><span class="nt">(package)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">def</span> <span class="nf">from_package</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span><span class="sd">     Return a Traversable object for the given package.</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">14</span>     <span class="k">return</span> <span class="n">fallback_resources</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">__spec__</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/importlib/_common.py:18,</span> in <span class="ni">fallback_resources</span><span class="nt">(spec)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="k">def</span> <span class="nf">fallback_resources</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">18</span>     <span class="n">package_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">archive_path</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">archive</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:1082,</span> in <span class="ni">Path.__new__</span><span class="nt">(cls, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span> <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Path</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>     <span class="bp">cls</span> <span class="o">=</span> <span class="n">WindowsPath</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="n">PosixPath</span>
<span class="ne">-&gt; </span><span class="mi">1082</span> <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_parts</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1083</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flavour</span><span class="o">.</span><span class="n">is_supported</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>     <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cannot instantiate </span><span class="si">%r</span><span class="s2"> on your system&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1085</span>                               <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:707,</span> in <span class="ni">PurePath._from_parts</span><span class="nt">(cls, args, init)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span> <span class="k">def</span> <span class="nf">_from_parts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span>     <span class="c1"># We need to call _parse_args on the instance, so as to get the</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="c1"># right flavour.</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">707</span>     <span class="n">drv</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_drv</span> <span class="o">=</span> <span class="n">drv</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/pathlib.py:691,</span> in <span class="ni">PurePath._parse_args</span><span class="nt">(cls, args)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span>     <span class="n">parts</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">_parts</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">691</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>         <span class="c1"># Force-cast str subclasses to str (issue #21127)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>         <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="ne">TypeError</span>: expected str, bytes or os.PathLike object, not NoneType
</pre></div>
</div>
</div>
</div>
<p>❓</p>
<p><em><strong>This architecture was designed using the C. elegans motor circuit that can swim right at birth i.e it should already have really good priors. Can you try visualizing an agent with an untrained NCAP model. Can it swim?</strong></em></p>
</section>
</section>
<section id="plot-perfomance">
<h2>3.3 Plot perfomance<a class="headerlink" href="#plot-perfomance" title="Permalink to this heading">#</a></h2>
<p>Now we are going to visualize performance of our model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_performance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model Performance&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the performance of multiple models on the same axes using Seaborn for styling.</span>

<span class="sd">    Reads CSV log files from specified paths and plots the mean episode scores</span>
<span class="sd">    achieved during testing against the cumulative time steps for each model.</span>
<span class="sd">    The plot uses a logarithmic scale for the x-axis to better display the progression</span>
<span class="sd">    over a wide range of steps. Each line&#39;s legend is set to the name of the last folder</span>
<span class="sd">    in the path, representing the model&#39;s name. Seaborn styles are applied for enhanced visualization.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - paths (list of str): Paths to the experiment directories.</span>
<span class="sd">    - ax (matplotlib.axes.Axes, optional): A matplotlib axis object to plot on. If None,</span>
<span class="sd">      a new figure and axis are created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set the Seaborn style</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>  <span class="c1"># Colorblind-friendly palette</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
        <span class="c1"># Extract the model name from the path</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>

        <span class="c1"># Load data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;log.csv&#39;</span><span class="p">))</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;test/episode_score/mean&#39;</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;test/episode_length/mean&#39;</span><span class="p">]</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Time Steps&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Max Episode Score&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1">#Replace the paths with the path to models you trained to plot their performance.</span>
<span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_ncap_ppo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;data/local/experiments/tonic/swimmer-swim/pretrained_mlp_ppo&#39;</span>
<span class="p">]</span>
<span class="n">plot_performance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;MLP v/s NCAP&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/620ac4ef180c2a63077f0963bc06bdbdc96e3bf30e3a404fc9d02291b3253629.png" src="../../_images/620ac4ef180c2a63077f0963bc06bdbdc96e3bf30e3a404fc9d02291b3253629.png" />
</div>
</div>
<p>❓</p>
<ul class="simple">
<li><p><em><strong>Compare the performance and learning curve of NCAP to MLP for the basic swimmer agent.</strong></em></p></li>
<li><p><em><strong>Try testing the model on a modification of the environment (e.g., the 12-link swimmer) it was trained on.</strong></em></p></li>
<li><p><em><strong>What happens if we remove certain weight constraints (e.g., sign constraint) from the NCAP model?</strong></em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add your code</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="section-4-visualizing-the-sparse-network">
<h1>Section 4: Visualizing the sparse network<a class="headerlink" href="#section-4-visualizing-the-sparse-network" title="Permalink to this heading">#</a></h1>
<p>Given the importance of architectural choices in our project we have provided a function which can visualize the network architecture. This includes the ability to render the NCAP network, representing the C. Elegans connectome.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">draw_network</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NCAP&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">include_speed_control</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_turn_control</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws a network graph for a swimmer model based on either NCAP or MLP architecture.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - mode (str): Determines the architecture type (&#39;NCAP&#39; or &#39;MLP&#39;). Defaults to &#39;NCAP&#39;.</span>
<span class="sd">    - N (int): Number of joints in the swimmer model. Defaults to 2.</span>
<span class="sd">    - include_speed_control (bool): If True, includes nodes for speed control in the graph.</span>
<span class="sd">    - include_turn_control (bool): If True, includes nodes for turn control in the graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

    <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="mi">4</span>

    <span class="n">nodes</span> <span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">include_speed_control</span><span class="p">:</span>
      <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;1-s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">7</span>
    <span class="k">if</span> <span class="n">include_turn_control</span><span class="p">:</span>
      <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">5</span>
      <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">3</span>

    <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$o^d$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">0</span>
    <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$o^v$&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>

    <span class="n">custom_node_positions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">])</span>
    <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;$o^d$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$o^d$&#39;</span><span class="p">])</span>
    <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;$o^v$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$o^v$&#39;</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">include_speed_control</span><span class="p">:</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;1-s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;1-s&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">include_turn_control</span><span class="p">:</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
      <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$\overset{..}</span><span class="si">{q}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$q^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>
      <span class="n">custom_node_positions</span><span class="p">[</span><span class="s1">&#39;$\overset{..}</span><span class="si">{q}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;$\overset{..}</span><span class="si">{q}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;NCAP&#39;</span><span class="p">:</span>
        <span class="c1"># Add edges between nodes</span>
        <span class="n">edges_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
        <span class="n">edge_labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;$o^d$&#39;</span><span class="p">):</span><span class="s1">&#39;+1&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;$o^v$&#39;</span><span class="p">):</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;$o^d$&#39;</span><span class="p">,</span> <span class="s1">&#39;$b^d_1$&#39;</span><span class="p">):</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;$o^v$&#39;</span><span class="p">,</span> <span class="s1">&#39;$b^v_1$&#39;</span><span class="p">):</span><span class="s1">&#39;o&#39;</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">include_speed_control</span><span class="p">:</span>
          <span class="n">edges_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
          <span class="n">edge_labels</span><span class="p">[(</span><span class="s1">&#39;1-s&#39;</span><span class="p">,</span> <span class="s1">&#39;$b^d_1$&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;s, to all b&#39;</span>
        <span class="k">if</span> <span class="n">include_turn_control</span><span class="p">:</span>
          <span class="n">edges_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
          <span class="n">edge_labels</span><span class="p">[(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;$b^d_1$&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
          <span class="n">edge_labels</span><span class="p">[(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;$b^v_1$&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">edges_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>

            <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$q_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$q^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;+1&#39;</span>
            <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$q_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$q^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
            <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$q^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;p&#39;</span>
            <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$q^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;p&#39;</span>

          <span class="n">edges_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>

          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>
          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$b^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>
          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$b^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$m^v_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\overset{..}</span><span class="si">{q}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
          <span class="n">edge_labels</span><span class="p">[((</span><span class="sa">f</span><span class="s1">&#39;$m^d_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\overset{..}</span><span class="si">{q}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="s1">&#39;+1&#39;</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="n">edge_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;MLP&#39;</span><span class="p">:</span>
      <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">layers_nodes</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">custom_node_positions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">layers_nodes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">layer_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node1</span> <span class="ow">in</span> <span class="n">layers_nodes</span><span class="p">[</span><span class="n">layer_ind</span><span class="p">]:</span>
          <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">layers_nodes</span><span class="p">[</span><span class="n">layer_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">))</span>
      <span class="n">edges_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>


    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

    <span class="c1"># Draw the graph using the custom node positions</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;edge_color&quot;</span><span class="p">:</span> <span class="n">edges_colors</span><span class="p">,</span> <span class="s2">&quot;edgecolors&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:gray&quot;</span><span class="p">,</span> <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;node_color&#39;</span><span class="p">:</span><span class="s1">&#39;white&#39;</span><span class="p">}</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">custom_node_positions</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">arrowsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;NCAP&#39;</span><span class="p">:</span>
      <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">custom_node_positions</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="n">edge_labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_network</span><span class="p">(</span><span class="s1">&#39;MLP&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/95093590a9df927c6acdbccfa7b1f50743a9c23ef10bc170c3b06ba4013ed4c1.png" src="../../_images/95093590a9df927c6acdbccfa7b1f50743a9c23ef10bc170c3b06ba4013ed4c1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_network</span><span class="p">(</span><span class="s1">&#39;NCAP&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">include_speed_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_turn_control</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5861d27de3cd891a6251ebc061e3f382febd42377f6eae185b0afff78ab22090.png" src="../../_images/5861d27de3cd891a6251ebc061e3f382febd42377f6eae185b0afff78ab22090.png" />
</div>
</div>
<p>Notice that the NCAP architecture is highly sparse and interpretable as compared to the MLP. Moreover notice that the ncap architecture can be completely embedded within a fully connected MLP of 3 hidden layers and ReLU nonlinearities. This enables us to do a thorough investigation into how specific architectural elements influence both performance and the learning process. By leveraging this capability, we can systematically analyze the impact of the architectural preferences inherent to the model and make better design choices.</p>
<p><em>It might be useful to also visualize the network’s activity for NCAP. Given it only has 4 learnable parameters it becomes much easier to interpret the network.</em></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h1>
<p>Based on the concepts we’ve discussed in this tutorial, you should now be equipped to advance with the project. Within this project, there are multiple pathways you can explore. For each pathway, you will delve deeply into one of the main sections outlined in this notebook, allowing for a thorough investigation of different factors that can influence performance:</p>
<ul class="simple">
<li><p><em><strong>Exploring the effects of environment:</strong></em> Investigate how different environmental settings impact agent performance. This could involve altering parameters of the environment or the types of tasks and reward functions. Understanding these effects can help in making better architectural choices and learning algorithms that result in agents that are robust and adaptable</p></li>
<li><p><em><strong>Exploring the effects of learning algorithms:</strong></em> Standard RL algorithms often struggle with sparse and constrained networks, which can lead to suboptimal performance. Explore where these algorithms fail and analyze potential reasons for their limitations. Experiment with modifications or alternative algorithms that might overcome these challenges.</p></li>
<li><p><em><strong>Exploring the effects of model architecture:</strong></em> Investigate how various architectural decisions within the NCAP model influence its performance. Visualize the model and its activity and explore potential improvements by tweaking architectural elements, assessing how these changes affect learning outcomes and operational efficiency.</p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./projects/project-notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../docs/datasets_overview.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Datasets</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="Microlearning.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Microlearning</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Macrocircuits
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-background">
       Project Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-slides">
       Project slides
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#project-template">
       Project Template
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-setup">
   Initial Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-colab-gpu-case-uncomment-if-you-want-to-use-this-one">
     Installing Dependencies (Colab GPU case, uncomment if you want to use this one)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-kaggle-gpu-case-uncomment-if-you-want-to-use-this-one">
     Installing Dependencies (Kaggle GPU case, uncomment if you want to use this one)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installing-dependencies-cpu-case-comment-if-you-want-to-use-gpu-one">
     Installing Dependencies (CPU case, comment if you want to use GPU one)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#imports-and-utility-functions">
       Imports and Utility Functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#importing-libraries">
         Importing Libraries
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#utility-code-for-displaying-videos">
         Utility code for displaying videos
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-1-exploring-the-deepmind-swimmer">
   Section 1: Exploring the DeepMind Swimmer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-basic-swim-task-for-the-swimmer-environment">
     1.1 Create a basic swim task for the swimmer environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vizualizing-an-agent-that-takes-random-actions-in-the-environment">
     1.2 Vizualizing an agent that takes random actions in the environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#swimmer-agent-api">
     1.3 Swimmer Agent API
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-simple-modification-to-the-agent">
     1.4 Example of simple modification to the agent
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-2-training-models-on-the-swim-task">
   Section 2: Training models on the swim task
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-install-tonic-library-for-training-agents">
     Download and install tonic library for training agents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-1-defining-the-train-function">
     Section 2.1 Defining the train function
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-2-training-mlp-model-on-swim-task">
     Section 2.2 Training MLP model on swim task
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#section-2-3-function-to-run-any-model-on-the-environment-and-generate-video">
     Section 2.3 Function to run any model on the environment and generate video
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#uncomment-and-use-gpu-to-observe-video">
       Uncomment and use GPU to observe video
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-3-ncap">
   Section 3: NCAP
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paper-illustration">
     Paper Illustration
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ncap-classes">
     3.1 NCAP classes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-1-defining-the-constraints">
       Section 3.1.1 Defining the constraints
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-2-defining-the-swimmermodule">
       Section 3.1.2: Defining the
       <em>
        <strong>
         SwimmerModule
        </strong>
       </em>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#section-3-1-3-defining-the-swimmeractor-wrapper">
       Section 3.1.3: Defining the
       <em>
        <strong>
         SwimmerActor
        </strong>
       </em>
       wrapper
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-ncap">
     3.2: Train NCAP
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Uncomment and use GPU to observe video
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-perfomance">
     3.3 Plot perfomance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-4-visualizing-the-sparse-network">
   Section 4: Visualizing the sparse network
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neuromatch
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
<a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a>
<a href="https://opensource.org/licenses/BSD-3-Clause"><img src="https://camo.githubusercontent.com/9b9ea65d95c9ef878afa1987df65731d47681336/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f736561626f726e2e737667"></a>
The contents of this repository are shared under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
Software elements are additionally licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD (3-Clause) License</a>.
</div>

</div>
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>